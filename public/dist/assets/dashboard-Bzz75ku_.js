import{o as jn,s as Dn,c as v,b,d,e as T,f as Q,q as Ps,m as Ls,t as qe,F as Hn,h as Un,z as $n,A as _n}from"./bootstrap-Bn5f6dfe.js";function Fn(y={}){const ae=document.querySelectorAll(".admin-nav"),Ve=document.querySelectorAll(".admin-panel"),p=document.getElementById("videoSourceList"),P=document.getElementById("videoSourceListSaveStatus"),Sa=document.getElementById("videoSourceBulkActions"),at=document.getElementById("videoSourceBulkEnable"),st=document.getElementById("videoSourceBulkDisable"),Mt=document.getElementById("panList"),Rs=document.getElementById("panListSaveStatus"),Ca=document.getElementById("panHeaderName"),Ea=document.getElementById("panHeaderEnable"),Aa=document.getElementById("panHeaderSort"),C=document.getElementById("panSettingsTabs"),ut=document.getElementById("panSettingsContent"),Is=document.getElementById("panSettingsStatus"),xt=document.getElementById("panSettingsMoreBtn"),K=document.getElementById("panSettingsMoreMenu"),me=document.getElementById("panSettingsScrollLeft"),ye=document.getElementById("panSettingsScrollRight"),vt=document.getElementById("searchSettingsList"),Os=document.getElementById("searchSettingsSaveStatus"),Ba=document.getElementById("searchHeaderName"),Pa=document.getElementById("searchHeaderCover"),La=document.getElementById("searchHeaderSort"),$=document.getElementById("openListSettingsForm"),Ns=document.getElementById("openListSaveStatus"),he=document.getElementById("openListQuarkTvMode"),We=document.getElementById("goProxySettingsForm"),Ms=document.getElementById("goProxySaveStatus"),fe=document.getElementById("goProxyEnabled"),xe=document.getElementById("goProxyAutoSelect"),Ra=document.getElementById("goProxyServersJson"),ve=document.getElementById("goProxyServerInput"),Ia=document.getElementById("goProxyServerAdd"),be=document.getElementById("goProxyServerList"),Tt=document.getElementById("videoSourceImportFromCatPawOpen"),ze=document.getElementById("magicEpisodeRulePatternInput"),Je=document.getElementById("magicEpisodeRuleReplaceInput"),Oa=document.getElementById("magicEpisodeRuleAdd"),se=document.getElementById("magicEpisodeRuleList"),Ft=document.getElementById("magicEpisodeRuleStatus"),we=document.getElementById("magicEpisodeRuleTestInput"),Na=document.getElementById("magicEpisodeRuleTestBtn"),Ts=document.getElementById("magicEpisodeRuleTestOutput"),Ge=document.getElementById("magicEpisodeCleanRegexRuleInput"),Ma=document.getElementById("magicEpisodeCleanRegexRuleAdd"),ke=document.getElementById("magicEpisodeCleanRegexRuleList"),qt=document.getElementById("magicEpisodeCleanRegexRuleStatus"),Qe=document.getElementById("magicAggregateRuleInput"),Ta=document.getElementById("magicAggregateRuleAdd"),ne=document.getElementById("magicAggregateRuleList"),Vt=document.getElementById("magicAggregateRuleStatus"),Se=document.getElementById("magicAggregateRuleTestInput"),ja=document.getElementById("magicAggregateRuleTestBtn"),js=document.getElementById("magicAggregateRuleTestOutput"),Ke=document.getElementById("magicAggregateRegexRuleInput"),Da=document.getElementById("magicAggregateRegexRuleAdd"),Ce=document.getElementById("magicAggregateRegexRuleList"),Wt=document.getElementById("magicAggregateRegexRuleStatus"),j={site:!1,user:!1,video:!1,pan:!1,interface:!1,search:!1,magic:!1},S={site:!1,user:!1,video:!1,pan:!1,interface:!1,search:!1,magic:!1},Ee={muted:"text-gray-500 dark:text-gray-400",mutedXs:"text-xs text-gray-500 dark:text-gray-400",mutedMonoXs:"text-xs text-gray-500 dark:text-gray-400 font-mono flex-shrink-0"},h=(t,e={})=>{const a=document.createElement(t),s=e.className!=null?String(e.className):"";return s&&(a.className=s),e.text!=null&&(a.textContent=String(e.text)),e.html!=null&&(a.innerHTML=String(e.html)),a},_=(t,e)=>{if(!t||!e)return t;try{Object.assign(t.style,e)}catch{}return t},zt=(t,{width:e,minWidth:a,maxWidth:s,flex:n="0 0 auto",display:r="inline-block"}={})=>_(t,{width:e,minWidth:a,maxWidth:s,flex:n,display:r,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),bt=(t,{minWidth:e,width:a,flex:s,display:n="inline-flex"}={})=>_(t,{display:n,alignItems:"center",justifyContent:"center",minWidth:e,width:a,flex:s}),Ha={up:'<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m18 15-6-6-6 6"/></svg>',down:'<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>'},Xe=(t,{dirAttr:e,keyAttr:a,key:s,disabledUp:n,disabledDown:r}={})=>{if(!t)return;const i=h("div",{className:"sort-btn-group"}),o=h("button",{className:"sort-btn",html:Ha.up});o.type="button",o.setAttribute(String(e||"data-sort"),"up"),o.setAttribute(String(a||"data-site-key"),String(s||"")),o.disabled=!!n;const c=h("button",{className:"sort-btn",html:Ha.down});c.type="button",c.setAttribute(String(e||"data-sort"),"down"),c.setAttribute(String(a||"data-site-key"),String(s||"")),c.disabled=!!r,i.appendChild(o),i.appendChild(c),t.appendChild(i)},re=(t,e="无数据")=>{t&&t.appendChild(h("li",{className:Ee.muted,text:e}))},Ua=(t,e,a)=>{if(!t)return;const s=a!=null?String(a):"";if(!s){t.classList.add("hidden");try{t.hidden=!0}catch{}t.textContent="",t.classList.remove("text-green-600","text-red-600");return}t.classList.remove("hidden","text-green-600","text-red-600");try{t.hidden=!1}catch{}e==="success"&&t.classList.add("text-green-600"),e==="error"&&t.classList.add("text-red-600"),t.textContent=s},F=t=>(e,a)=>Ua(t,e,a),X=(t,e)=>!t||t.dataset&&t.dataset.bound==="true"?!1:(t.dataset&&(t.dataset.bound="true"),typeof e=="function"&&e(t),!0),Ds=(t,e)=>{const a=Array.isArray(t)?t:[],s=typeof e=="function"?e:()=>"";return a.reduce((n,r)=>{const i=s(r);return Math.max(n,(i!=null?String(i):"").length)},0)},Ze=(t,e,{min:a=1,pad:s=2}={})=>{const n=Math.max(Ds(t,e),Number(a)||0),r=Number.isFinite(Number(s))?Number(s):2;return{maxLen:n,width:`${n}ch`,maxWidth:`${n+r}ch`}},pt=t=>{const e=Number(t),a=Number.isFinite(e)?Math.max(0,e):0;return{minWidth:`${a}px`,width:`${a}px`,flex:`0 0 ${a}px`}},wt=(t,e)=>_(t,{display:"inline-block",textAlign:"center",...pt(e)}),ie=({checked:t,disabled:e,title:a,ariaLabel:s,inputAttrs:n,onChange:r})=>{const i=h("label",{className:"enable-switch"});a&&(i.title=String(a));const o=document.createElement("input");o.type="checkbox",o.checked=!!t,o.disabled=!!e,s&&o.setAttribute("aria-label",String(s)),n&&typeof n=="object"&&Object.entries(n).forEach(([l,u])=>{u!=null&&o.setAttribute(String(l),String(u))}),typeof r=="function"&&o.addEventListener("change",r);const c=h("span",{className:"enable-slider"});return i.appendChild(o),i.appendChild(c),{label:i,input:o}},Jt=async(t,e,a)=>{const s=await fetch(t,e),n=a??{},r=await s.json().catch(()=>n);return{resp:s,data:r}},$a=(t,e)=>Jt(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e??{})},{}),kt=async(t,e={})=>{try{const a=e&&typeof e=="object"?e:{},{resp:s,data:n}=await Jt(t,{method:"GET",...a},{});if(s.ok&&n&&n.success)return n}catch{}return null},I=(t,e)=>{const a=new URLSearchParams;return e&&typeof e=="object"&&Object.entries(e).forEach(([s,n])=>{a.append(String(s),n!=null?String(n):"")}),Jt(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()},{})},oe=t=>{const e={};if(!t)return e;try{const a=new FormData(t);for(const[s,n]of a.entries())e[s]=n!=null?String(n):""}catch{}return e},Ae=async(t,e,a)=>{if(!t||!t.dataset)return typeof a=="function"?a():void 0;const s=e;if(t.dataset[s]!=="true"){t.dataset[s]="true";try{return await(typeof a=="function"?a():void 0)}finally{try{delete t.dataset[s]}catch{}}}},jt=(t,e=1200)=>{if(typeof t!="function")return;const a=Number(e),s=Number.isFinite(a)?a:1200;setTimeout(()=>t("",""),s)},Ye=(t,e,a)=>{const s=Array.isArray(t)?t.slice():[],n=Number(e),r=Number(a);if(!Number.isInteger(n)||!Number.isInteger(r)||n<0||r<0||n>=s.length||r>=s.length||n===r)return s;const i=s[n];return s[n]=s[r],s[r]=i,s};let Be=null;const Hs=new Set(["site","user","video","pan","interface","search","magic","live"]),Pe=t=>{const e=typeof t=="string"?t.trim().toLowerCase():"";return Hs.has(e)?e:"site"},_a=()=>{const e=(typeof window.location.hash=="string"?window.location.hash:"").replace(/^#/,"").trim();return Pe(e)},Us=t=>{const e=Pe(t);(window.location.hash||"").replace(/^#/,"")!==e&&(window.location.hash=`#${e}`)},ta=t=>{const e=Pe(t);Ve.forEach(s=>s.classList.add("hidden")),ae.forEach(s=>{const n=s.dataset.admin===e;s.setAttribute("data-active",n?"true":"false")});const a=document.querySelector(`#admin${e.charAt(0).toUpperCase()}${e.slice(1)}`);a&&a.classList.remove("hidden")};let Z=[],ea=!1;const Le=t=>{const e=typeof t=="string"?t.trim():"";if(!e)return"";try{const a=new URL(e);return a.protocol!=="http:"&&a.protocol!=="https:"?"":(a.hash="",a.search="",a.toString().replace(/\/+$/g,""))}catch{return""}},$s=t=>{try{const e=JSON.parse(String(t||""));return Array.isArray(e)?e:[]}catch{return[]}},q=t=>{const e=typeof t=="string"?t.trim():"";if(!e)return"";try{const a=new URL(e);a.hash="",a.search="";let s=a.pathname||"/";const n=s.indexOf("/spider/");return n>=0&&(s=s.slice(0,n)||"/"),s=s.replace(/\/spider\/?$/,"/")||"/",s=s.replace(/\/(full-config|config|website)\/?$/,"/")||"/",s.endsWith("/")||(s+="/"),a.pathname=s,a.toString()}catch{return""}},Fa=()=>{const t=y&&y.user&&typeof y.user.username=="string"?y.user.username.trim():"";return t?{"X-TV-User":t}:{}},nt=async({apiBase:t,path:e,method:a,body:s})=>{const n=q(t);if(!n)throw new Error("CatPawOpen 接口地址无效");const r=String(e||"").replace(/^\//,""),i=new URL(r,n),o={"Content-Type":"application/json",...Fa()},{resp:c,data:l}=await Jt(i.toString(),{method:a||"GET",headers:o,body:s!=null?JSON.stringify(s):void 0,credentials:"omit"},{}),u=c&&typeof c.status=="number"?c.status:0;if(!c.ok){const g=l&&l.message?String(l.message):`HTTP ${u}`,m=new Error(g);throw m.status=u,m}return l},aa=(t,e="")=>{const a=document.getElementById("catPawOpenRemoteSettings"),s=document.getElementById("catPawOpenRemoteError");try{if(a&&a.classList.toggle("hidden",t!=="ready"),s){const n=t==="error";s.classList.toggle("hidden",!n),s.textContent=n?e||"CatPawOpen 接口异常":""}t==="hidden"&&s&&(s.classList.add("hidden"),s.textContent="")}catch{}},sa=async t=>{const e=document.querySelector('#catPawOpenSettingsForm input[name="catPawOpenApiBase"]'),a=typeof t=="string"?t:e&&typeof e.value=="string"?e.value:"",s=q(a);if(!s)return aa("hidden"),{ok:!1,skipped:!0,reason:"unconfigured"};try{const n=await nt({apiBase:s,path:"admin/settings",method:"GET"}),r=document.querySelector('#catPawOpenSettingsForm input[name="catPawOpenProxy"]');r&&n&&n.settings&&typeof n.settings.proxy=="string"&&(r.value=n.settings.proxy||"");const i=document.getElementById("catPawOpenDirectLinkEnabled");return i&&n&&n.settings&&(i.checked=!!n.settings.directLinkEnabled),aa("ready"),{ok:!0,data:{settingsResp:n}}}catch(n){return aa("error"),{ok:!1,skipped:!1,reason:"error",error:n}}},_s=async t=>{const e=q(t);if(!e)return{ok:!1,skipped:!0,reason:"unconfigured"};const a=document.querySelector('#catPawOpenSettingsForm input[name="catPawOpenProxy"]'),s=a&&typeof a.value=="string"?a.value:"",n=document.getElementById("catPawOpenDirectLinkEnabled"),r=!!(n&&n.checked),i=[];try{const o=await nt({apiBase:e,path:"admin/settings",method:"PUT",body:{proxy:String(s||""),directLinkEnabled:r}});return a&&o&&o.settings&&typeof o.settings.proxy=="string"&&(a.value=o.settings.proxy||""),n&&o&&o.settings&&(n.checked=!!o.settings.directLinkEnabled),{ok:!0,parts:[],data:o}}catch(o){const c=o&&o.message?String(o.message):"同步失败";return i.push(c),{ok:!1,parts:i}}},Gt=t=>{if(!t)throw new Error("CatPawOpen 返回为空");if(t&&typeof t=="object"){if(t.code===0||t.success===!0&&Object.prototype.hasOwnProperty.call(t,"data")||Object.prototype.hasOwnProperty.call(t,"data"))return t.data;const e=typeof t.message=="string"?t.message:"";if(e)throw new Error(e)}return t},Fs=()=>{const t=At?At.querySelector('input[name="catPawOpenApiBase"]'):null;if(t){const e=typeof t.value=="string"?t.value.trim():"";if(e)return e;const a=typeof t.getAttribute=="function"?String(t.getAttribute("value")||"").trim():"";if(a)return a}return y&&y.settings&&typeof y.settings.catPawOpenApiBase=="string"?String(y.settings.catPawOpenApiBase||"").trim():""},D={t:0,v:"",inFlight:null},qs=()=>{try{const t=document.getElementById("catPawOpenSettingsForm"),e=t?t.querySelector('input[name="catPawOpenApiBase"]'):null;if(!e)return"";const a=typeof e.value=="string"?e.value.trim():"";return a||(typeof e.getAttribute=="function"?String(e.getAttribute("value")||"").trim():"")||""}catch{return""}},Dt=async(t=10*1e3)=>{const e=qs()||Fs();if(e)return D.v=e,D.t=Date.now(),e;const a=Date.now();if(D.v&&a-D.t<t)return D.v;if(D.inFlight)return await D.inFlight;D.inFlight=(async()=>{try{const s=await kt("/dashboard/site/settings"),n=s&&typeof s.catPawOpenApiBase=="string"?s.catPawOpenApiBase.trim():"";if(D.v=n,D.t=Date.now(),n)try{const r=document.getElementById("catPawOpenSettingsForm"),i=r?r.querySelector('input[name="catPawOpenApiBase"]'):null;i&&(i.value=n)}catch{}return n}catch{return D.v="",D.t=Date.now(),""}})();try{return await D.inFlight}finally{D.inFlight=null}},Vs=async({apiBase:t,path:e})=>{const a=q(t);if(!a)throw new Error("CatPawOpen 接口地址未设置");const s=String(e).replace(/^\//,""),n=new URL(s,a);try{const o=String(n.hostname||"").toLowerCase(),c=String(window&&window.location&&window.location.hostname||"").toLowerCase();if((o==="localhost"||o==="127.0.0.1"||o==="::1")&&!(c==="localhost"||c==="127.0.0.1"||c==="::1"))return!1}catch{}const r=Fa(),i=await fetch(n.toString(),{method:"GET",headers:r,credentials:"omit"});return i&&i.ok},Qt=F(Ms),Kt=F(Ns),qa=t=>{const e=Le(t);return e?`${e}/`:""},Va=t=>{const e=typeof t=="string"?t.trim():"";if(!e)return"";let a=e;return a.startsWith("/")||(a=`/${a}`),a.endsWith("/")||(a=`${a}/`),a=a.replace(/\/{2,}/g,"/"),a},Ws=async({apiBase:t,token:e,mountPath:a})=>{const s=qa(t);if(!s)throw new Error("OpenList 服务器地址不是合法 URL");const n=typeof e=="string"?e.trim():"";if(!n)throw new Error("OpenList 令牌未设置");const r=Va(a);if(!r)throw new Error("夸克TV挂载目录未设置");const i=new URL("api/fs/get",s).toString(),o=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:n},body:JSON.stringify({path:r,password:"",page:1,per_page:0,refresh:!0}),credentials:"omit"});if(o.status===401){const u=new Error("OpenList 令牌错误");throw u.status=401,u}if(o.status===500){const u=new Error("夸克TV挂载目录错误");throw u.status=500,u}const c=await o.json().catch(()=>({}));if(!o.ok){const u=c&&c.message?String(c.message):`HTTP ${o.status}`,g=new Error(u);throw g.status=o.status,g}if((c&&typeof c.code=="number"?c.code:0)!==200){const u=c&&c.message?String(c.message):"验证失败",g=new Error(u);throw g.status=o.status,g}return{ok:!0}},Wa=t=>{const e=Array.isArray(t)?t:[],a=[],s=new Set;return e.forEach(n=>{const r=Le(typeof n=="string"?n:n&&n.base);if(!r)return;const i=r.toLowerCase();if(s.has(i))return;s.add(i);const o=n&&typeof n=="object"&&typeof n.pans=="object"&&n.pans?n.pans:{},c=Object.prototype.hasOwnProperty.call(o,"baidu"),l=Object.prototype.hasOwnProperty.call(o,"quark");a.push({base:r,pans:{baidu:c?!!o.baidu:!0,quark:l?!!o.quark:!0}})}),a},Re=()=>{if(be){if(be.innerHTML="",!Z.length){re(be);return}Z.forEach((t,e)=>{const a=h("li",{className:"flex items-center gap-3 rounded-lg border border-gray-200 dark:border-white/10 bg-white/60 dark:bg-white/5 px-3 py-2"}),s=h("span",{className:"min-w-0 flex-1 truncate",text:t.base}),n=h("div",{className:"flex items-center gap-3 shrink-0"}),r=(o,c)=>{const l=h("div",{className:"flex items-center gap-2"}),u=h("span",{className:Ee.mutedXs,text:c}),{label:g,input:m}=ie({checked:!!(t.pans&&t.pans[o]),onChange:()=>{const f=Z.slice(),k=f[e];k&&(k.pans=Object.assign({},k.pans,{[o]:!!m.checked}),f[e]=k,Z=f,Re())}});return l.appendChild(u),l.appendChild(g),l};n.appendChild(r("baidu","百度")),n.appendChild(r("quark","夸克"));const i=document.createElement("button");i.type="button",i.className="px-3 py-1.5 rounded-lg border border-gray-200 dark:border-white/10 bg-white/60 dark:bg-white/5 text-xs text-gray-700 dark:text-gray-100 hover:bg-gray-100/50 dark:hover:bg-white/10 transition-colors duration-150",i.textContent="删除",i.addEventListener("click",()=>{Z=Z.filter((o,c)=>c!==e),Re()}),a.appendChild(s),a.appendChild(n),a.appendChild(i),be.appendChild(a)})}};ae.forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const a=Pe(t.dataset.admin||"site");ta(a),Us(a),xa(a)})}),ae.length&&Ve.length&&(Be=_a(),ta(Be)),window.addEventListener("hashchange",()=>{const t=_a();ta(t),xa(t)});const Ie=document.getElementById("doubanDataSelect"),za=document.getElementById("doubanDataCustom"),Oe=document.getElementById("doubanImgSelect"),Ja=document.getElementById("doubanImgCustom"),Ne=(t,e)=>{if(!t||!e)return;const a=t.value;e.classList.toggle("hidden",a!=="custom")};Ie&&Ie.addEventListener("change",()=>Ne(Ie,za)),Oe&&Oe.addEventListener("change",()=>Ne(Oe,Ja)),Ne(Ie,za),Ne(Oe,Ja);let Ga=!1;const Qa=()=>{try{document.querySelectorAll(".custom-dropdown-list").forEach(t=>t.classList.add("hidden"))}catch{}},zs=()=>{Ga||(Ga=!0,document.addEventListener("click",()=>Qa()))},na=t=>{if(!t||!t.parentNode||t.dataset.customDropdownMounted==="true")return;t.dataset.customDropdownMounted="true";const e=document.createElement("div");e.className="custom-dropdown",t.classList.add("hidden-select"),t.parentNode.insertBefore(e,t),e.appendChild(t);const a=document.createElement("button");a.type="button",a.className="custom-dropdown-btn";const s=t.options[t.selectedIndex]&&t.options[t.selectedIndex].text||"请选择";a.textContent=s;const n=document.createElement("div");n.className="custom-dropdown-list hidden",Array.from(t.options).forEach(r=>{const i=document.createElement("div");i.className="custom-dropdown-item",i.textContent=r.text,i.dataset.value=r.value,r.selected&&i.classList.add("active"),i.addEventListener("click",o=>{o.stopPropagation(),t.value=r.value,a.textContent=r.text,n.classList.add("hidden"),n.querySelectorAll(".custom-dropdown-item").forEach(c=>c.classList.remove("active")),i.classList.add("active"),t.dispatchEvent(new Event("change",{bubbles:!0}))}),n.appendChild(i)}),a.addEventListener("click",r=>{r.stopPropagation(),zs();const i=n.classList.contains("hidden");Qa(),n.classList.toggle("hidden",!i)}),e.appendChild(a),e.appendChild(n)},Ka=t=>{const e=document.getElementById(t);na(e)};Ka("doubanDataSelect"),Ka("doubanImgSelect");const rt=[{key:"baidu",name:"百度",type:"cookie"},{key:"quark",name:"夸克",type:"cookie"},{key:"uc",name:"UC",type:"cookie"},{key:"115",name:"115",type:"cookie"},{key:"tianyi",name:"天翼",type:"account"},{key:"pan123",name:"123",type:"account"},{key:"bili",name:"Bilibili",type:"cookie"},{key:"wuming",name:"观影",type:"cookie"},{key:"yunchao",name:"云巢",type:"account"},{key:"pan123ziyuan",name:"123资源网",type:"cookie"}];let Xt={};const ra=new Set;let Y=rt[0]?rt[0].key:"";const tt=F(Is),Xa=async t=>{const e=t?`?key=${encodeURIComponent(String(t))}`:"",a=await kt(`/dashboard/pan/settings${e}`);return a&&a.settings&&typeof a.settings=="object"?a.settings:{}},ia=async t=>{const e=typeof t=="string"?t.trim():"";if(!e||ra.has(e))return;tt("","加载中...");const a=await Xa(e);Xt=Object.assign({},Xt,a),ra.add(e),tt("","")},Js=async(t,e)=>Za(t,"cookie",{cookie:e!=null?String(e):""}),Gs=async(t,e,a)=>Za(t,"account",{username:e!=null?String(e):"",password:a!=null?String(a):""}),Za=async(t,e,a)=>{const n=Object.assign({key:t,type:e==="account"?"account":"cookie"},a&&typeof a=="object"?a:{}),{resp:r,data:i}=await I("/dashboard/pan/settings",n);return r.ok&&i&&i.success?{ok:!0,settings:i.settings||{}}:{ok:!1,message:i&&i.message||"保存失败",settings:i&&i.settings||null}},Qs=async(t,e)=>{const a=await Dt(),s=q(a);if(!s)return{ok:!1,skipped:!0,reason:"unconfigured"};const n=await nt({apiBase:s,path:t,method:"PUT",body:e??{}});return Gt(n),{ok:!0,skipped:!1}},Ks=async()=>{const t=await Dt(),e=q(t);if(!e)return{ok:!1,skipped:!0,reason:"unconfigured"};const a=await Xa(""),s=a&&typeof a=="object"?Object.entries(a):[];if(!s.length)return{ok:!0,skipped:!1,okCount:0,failCount:0};const n=new Map;rt.forEach(o=>{if(!o||!o.key)return;const c=o.type==="account"?"account":"cookie";n.set(o.key,c)});let r=0,i=0;for(let o=0;o<s.length;o+=1){const c=typeof s[o][0]=="string"?s[o][0].trim():"",l=s[o][1]&&typeof s[o][1]=="object"?s[o][1]:{};if(!c)continue;if((n.get(c)||"cookie")==="account"){const m=typeof l.username=="string"?l.username:"",f=typeof l.password=="string"?l.password:"";if(!m&&!f)continue;try{const k=await nt({apiBase:e,path:`website/${encodeURIComponent(c)}/account`,method:"PUT",body:{username:m,password:f}});Gt(k),r+=1}catch{i+=1}continue}const g=typeof l.cookie=="string"?l.cookie:"";if(g)try{const m=await nt({apiBase:e,path:`website/${encodeURIComponent(c)}/cookie`,method:"PUT",body:{cookie:g}});Gt(m),r+=1}catch{i+=1}}return{ok:i<=0,skipped:!1,okCount:r,failCount:i}},Xs=async()=>{const t=await Dt(),e=q(t);if(!e)return{ok:!1,skipped:!0,reason:"unconfigured"};try{const{resp:a,data:s}=await Jt("/dashboard/video/pans/list",{method:"GET"},{});if(!(a&&a.ok&&s&&s.success&&Array.isArray(s.pans)))return{ok:!0,skipped:!1};const n=de(s.pans),r=await nt({apiBase:e,path:"website/pans/list",method:"PUT",body:{list:n}});return Gt(r),{ok:!0,skipped:!1}}catch{return{ok:!1,skipped:!1}}},Zs=async()=>{const[t,e]=await Promise.all([Xs(),Ks()]);return{ok:!!(t&&t.ok!==!1&&e&&e.ok!==!1),pans:t,settings:e}},Ya=async({key:t,save:e,syncPath:a,syncBody:s})=>{tt("","保存中...");const n=await(typeof e=="function"?e():null);if(n&&n.settings&&(Xt=n.settings),t&&ra.add(t),n&&n.ok){tt("success","保存成功");try{const r=await Qs(a,s);if(r&&r.ok===!1&&r.reason==="unconfigured"){tt("error","CatPawOpen 接口地址未设置");return}tt("success","保存成功"),setTimeout(()=>tt("",""),1200)}catch{tt("error","CatPawOpen 接口异常")}}else tt("error",n&&n.message||"保存失败")},oa=()=>{if(!C)return;C.innerHTML="";const t=document&&document.documentElement&&document.documentElement.classList?document.documentElement.classList.contains("dark"):!1;rt.forEach(e=>{const a=document.createElement("button");a.type="button",a.className="px-3 py-1.5 rounded-full text-sm font-medium transition-colors duration-150 whitespace-nowrap text-gray-700 dark:text-gray-100 hover:bg-gray-100/30 dark:hover:bg-white/10",e.key===Y?(a.style.backgroundColor=t?"rgba(34, 197, 94, 0.22)":"rgba(34, 197, 94, 0.20)",a.style.border=t?"1px solid rgba(34, 197, 94, 0.35)":"1px solid rgba(34, 197, 94, 0.30)"):(a.style.backgroundColor="",a.style.border="1px solid transparent"),a.dataset.panTab=e.key,a.textContent=e.name,C.appendChild(a)})},Ys=()=>{if(!C||!xt||!K)return;const t=C.getBoundingClientRect();if(!t||t.width<=0)return;const e=2,a=Array.from(C.querySelectorAll("button[data-pan-tab]")),s=[];a.forEach(r=>{const i=r.dataset?r.dataset.panTab:"";if(r.getBoundingClientRect().right>t.right+e){const l=rt.find(u=>u.key===i);l&&s.push(l)}});const n=s.length>0;if(xt.classList.toggle("hidden",!n),!n){ca(),K.innerHTML="";return}K.innerHTML="",s.forEach(r=>{const i=document.createElement("button");i.type="button",i.className="w-full text-left px-3 py-2 text-sm whitespace-nowrap overflow-hidden text-ellipsis hover:bg-gray-50 dark:hover:bg-white/5 transition-colors duration-150",i.textContent=r.name,i.dataset.panTab=r.key,r.key===Y?i.style.backgroundColor="rgba(34, 197, 94, 0.12)":i.style.backgroundColor="",K.appendChild(i)})};let Me=0;const Zt=()=>{!C||!xt||!K||(Me&&cancelAnimationFrame(Me),Me=requestAnimationFrame(()=>{Me=0,Ys(),tn()}))},tn=()=>{if(!C)return;const t=C.scrollLeft||0,e=C.clientWidth||0,a=C.scrollWidth||0,s=2,n=a>e+s,r=t<=s,i=t+e>=a-s;me&&me.classList.toggle("hidden",!n||r),ye&&ye.classList.toggle("hidden",!n||i),xt&&(!n||i)&&xt.classList.add("hidden")},ts=t=>{if(!C)return;const e=(C.scrollLeft||0)+t;C.scrollTo({left:e,behavior:"smooth"})},es=t=>{const e=Xt&&Object.prototype.hasOwnProperty.call(Xt,t)?Xt[t]:{};return e&&typeof e=="object"?e:{}},da=()=>{if(!ut)return;const t=rt.find(u=>u.key===Y)||rt[0];if(!t)return;if(ut.innerHTML="",t.type==="cookie"){const u=h("button",{className:"btn-green",text:"保存"});u.type="button",u.setAttribute("data-pan-action","save-cookie"),u.setAttribute("data-pan-key",t.key);const g=h("div",{className:"flex flex-col items-start gap-3"});_(g,{width:"100%"});const m=h("textarea",{className:"tv-field"});m.rows=3,_(m,{width:"100%"}),m.placeholder=`请输入${t.name} Cookie`,m.value=(es(t.key).cookie||"").toString(),m.setAttribute("data-pan-cookie-input",t.key),g.appendChild(m);const f=h("div");_(f,{display:"flex",justifyContent:"center",width:"100%"}),f.appendChild(u),g.appendChild(f),ut.appendChild(g);return}const e=es(t.key),a=h("div",{className:"space-y-4 max-w-[640px]"}),s=h("div"),n=h("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",text:"账号"}),r=h("input",{className:"tv-field"});r.type="text",r.value=(e.username||"").toString(),r.setAttribute("data-pan-account-username",t.key),s.appendChild(n),s.appendChild(r);const i=h("div"),o=h("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",text:"密码"}),c=h("input",{className:"tv-field"});c.type="password",c.value=(e.password||"").toString(),c.setAttribute("data-pan-account-password",t.key),i.appendChild(o),i.appendChild(c);const l=h("button",{className:"btn-green",text:"保存"});l.type="button",l.setAttribute("data-pan-action","save-account"),l.setAttribute("data-pan-key",t.key),a.appendChild(s),a.appendChild(i),a.appendChild(l),ut.appendChild(a)};X(C,()=>{C.addEventListener("click",async t=>{const e=t.target;if(!e||!e.closest)return;const a=e.closest("button[data-pan-tab]");if(!a)return;const s=a.dataset.panTab||"";!s||s===Y||(Y=s,tt("",""),oa(),Zt(),await ia(Y),da())}),C.addEventListener("wheel",t=>{C&&(Math.abs(t.deltaY)<=Math.abs(t.deltaX)||(C.scrollLeft+=t.deltaY,t.preventDefault()))},{passive:!1}),C.addEventListener("scroll",()=>Zt()),window.addEventListener("resize",()=>Zt())});const ca=()=>{K&&K.classList.add("hidden")};X(me,()=>{me.addEventListener("click",t=>{t.preventDefault(),ts(-220)})}),X(ye,()=>{ye.addEventListener("click",t=>{t.preventDefault(),ts(220)})}),X(xt,()=>{K&&(xt.addEventListener("click",t=>{t.preventDefault(),Zt(),K.classList.toggle("hidden")}),document.addEventListener("click",t=>{const e=t.target;e&&(xt.contains(e)||K.contains(e)||ca())}),K.addEventListener("click",async t=>{const e=t.target;if(!e||!e.closest)return;const a=e.closest("button[data-pan-tab]");if(!a)return;const s=a.dataset.panTab||"";s&&(Y=s,ca(),tt("",""),oa(),Zt(),await ia(Y),da())}))}),X(ut,()=>{ut.addEventListener("click",async t=>{const e=t.target;if(!e||!e.closest)return;const a=e.closest("[data-pan-action]");if(!a)return;const s=a.getAttribute("data-pan-action")||"",n=a.getAttribute("data-pan-key")||"";if(!(!n||!rt.find(i=>i.key===n))){if(s==="save-cookie"){const i=ut.querySelector(`textarea[data-pan-cookie-input="${n}"]`),o=i?i.value:"";await Ya({key:n,save:()=>Js(n,o),syncPath:`website/${encodeURIComponent(n)}/cookie`,syncBody:{cookie:o!=null?String(o):""}});return}if(s==="save-account"){const i=ut.querySelector(`input[data-pan-account-username="${n}"]`),o=ut.querySelector(`input[data-pan-account-password="${n}"]`),c=i?i.value:"",l=o?o.value:"";await Ya({key:n,save:()=>Gs(n,c,l),syncPath:`website/${encodeURIComponent(n)}/account`,syncBody:{username:c!=null?String(c):"",password:l!=null?String(l):""}});return}}})});let E=[];const St=F(Rs),de=t=>Array.isArray(t)?t.map(e=>({key:e&&typeof e.key=="string"?e.key:"",name:e&&typeof e.name=="string"?e.name:"",enable:!!(e&&e.enable)})).filter(e=>e.key):[];async function as(t){const{resp:e,data:a}=await I("/dashboard/video/pans/list",{list:JSON.stringify(Array.isArray(t)?t:[])});return e.ok&&a&&a.success?{ok:!0,pans:Array.isArray(a.pans)?a.pans:[]}:{ok:!1,message:a&&a.message||"保存失败"}}const la=async()=>{const t=await Dt(),e=q(t);if(e)try{const a=await nt({apiBase:e,path:"website/pans/list",method:"GET"}),s=Gt(a),n=de(s);try{await as(n)}catch{}return n}catch{}try{const{resp:a,data:s}=await Jt("/dashboard/video/pans/list",{method:"GET"},{});if(a.ok&&s&&s.success&&Array.isArray(s.pans))return s.pans}catch{}return[]},ss=async t=>{const e=await Dt(),a=q(e);if(!a)return{ok:!1,message:"CatPawOpen 接口地址未设置"};const s=de(t);try{const n=await nt({apiBase:a,path:"website/pans/list",method:"PUT",body:{list:s}}),r=Gt(n),o=(Array.isArray(r)?de(r):null)||await la();return await as(o),{ok:!0,pans:o}}catch{return{ok:!1,message:"CatPawOpen 接口异常"}}};function Ct(t){if(!Mt)return;if(E=de(t),Mt.innerHTML="",!E.length){re(Mt);return}const e=h("span",{className:"text-sm font-medium"});_(e,{position:"absolute",visibility:"hidden",whiteSpace:"nowrap",left:"-99999px",top:"-99999px"}),document.body.appendChild(e);let a=0;E.forEach(n=>{const r=n&&(n.name||n.key)||"";e.textContent=r,a=Math.max(a,Math.ceil(e.getBoundingClientRect().width))}),document.body.removeChild(e);const s=Math.max(a,80);Ca&&_(Ca,{width:`${s}px`,flex:"0 0 auto",display:"inline-block",whiteSpace:"nowrap"}),Ea&&wt(Ea,72),Aa&&wt(Aa,72),E.forEach((n,r)=>{const i=h("li",{className:"tv-row"}),o=n.key||"",c=!!n.enable,l=document.createElement("span");l.className="text-sm font-medium text-gray-800 dark:text-gray-100",l.textContent=n.name||n.key||"",_(l,{width:`${s}px`,flex:"0 0 auto",display:"inline-block",whiteSpace:"nowrap"});const{label:u}=ie({checked:c,title:c?"已启用":"已禁用",ariaLabel:c?"已启用":"已禁用",inputAttrs:{"data-pan-enable-key":o}}),g=document.createElement("span");bt(g,pt(72)),g.appendChild(u);const m=document.createElement("span");bt(m,pt(72)),Xe(m,{dirAttr:"data-pan-sort",keyAttr:"data-pan-key",key:o,disabledUp:r===0,disabledDown:r===E.length-1}),i.appendChild(l),i.appendChild(g),i.appendChild(m),Mt.appendChild(i)})}let x=[];const V=new Set,ns=document.getElementById("videoSourceHeaderName"),rs=document.getElementById("videoSourceHeaderApi"),is=document.getElementById("videoSourceHeaderAvailability"),os=document.getElementById("videoSourceHeaderStatus"),ds=document.getElementById("videoSourceHeaderHome"),cs=document.getElementById("videoSourceHeaderSort"),Et=document.getElementById("videoSourceHeaderCheckbox"),it=document.getElementById("videoSourceBulkCheckDisable"),ls=t=>{const a=(typeof t=="string"?t:"").trim();if(!a)return"";if(a.indexOf("/spider/")===0){const s=a.split("/").filter(Boolean);if(s.length>=2&&s[0]==="spider")return s[1]}return a.replace(/^\/spider\//,"").replace(/\/\d+\/?$/,"")},ua=t=>{const e=typeof t=="string"?t.trim():"";return e==="valid"||e==="invalid"||e==="unknown"||e==="unchecked"?e:"unchecked"},en=t=>{const e=ua(t);return e==="valid"?"有效":e==="invalid"?"无效":e==="unknown"?"未知":"未检测"},an=t=>{const e=ua(t);return e==="valid"?"tag-green":e==="invalid"?"tag-red":e==="unknown"?"tag-yellow":"tag-gray"},sn=t=>{const e=document.createElement("span");return e.className=`availability-tag ${an(t)}`,e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="8"/><circle cx="12" cy="12" r="2" fill="currentColor" stroke="none"/></svg>${en(t)}`,e},us=()=>{if(!Et)return;const t=x.map(a=>a&&a.key||"").filter(Boolean);if(!t.length){Et.checked=!1,Et.indeterminate=!1;return}let e=0;t.forEach(a=>{V.has(a)&&(e+=1)}),Et.checked=e===t.length,Et.indeterminate=e>0&&e<t.length},ps=()=>{if(!Sa)return;const t=x.map(a=>a&&a.key||"").filter(Boolean);let e=0;t.forEach(a=>{V.has(a)&&(e+=1)}),Sa.classList.toggle("hidden",e<=0)},nn=()=>{const t=x.map(a=>a&&a.key||"").filter(Boolean),e=new Set(t);Array.from(V).forEach(a=>{e.has(a)||V.delete(a)})};function ot(t){if(!p)return;if(x=Array.isArray(t)?t:[],p.innerHTML="",nn(),us(),ps(),!x.length){re(p);return}const e=Ze(x,s=>s&&(s.name||s.key)||""),a=Ze(x,s=>ls(s&&s.api));ns&&zt(ns,{width:e.width,minWidth:"80px",maxWidth:e.maxWidth}),rs&&zt(rs,{width:a.width,minWidth:"90px",maxWidth:a.maxWidth}),os&&wt(os,72),ds&&wt(ds,72),cs&&wt(cs,72),is&&wt(is,96),x.forEach((s,n)=>{const r=h("li",{className:"tv-row"}),i=s&&s.key||"",o=s&&s.enabled!==!1,c=s&&s.home!==!1,l=document.createElement("input");l.type="checkbox",l.className="h-4 w-4 rounded border-gray-300 dark:border-white/20 text-green-600 focus:ring-green-500",l.setAttribute("data-select-key",i),l.checked=i?V.has(i):!1;const u=document.createElement("span");u.className="text-sm font-medium text-gray-800 dark:text-gray-100 truncate",u.textContent=s&&(s.name||s.key)||"",zt(u,{width:e.width,minWidth:"80px",maxWidth:e.maxWidth});const g=document.createElement("span");g.className=`${Ee.mutedXs} truncate`,g.textContent=ls(s&&s.api)||"",zt(g,{width:a.width,minWidth:"90px",maxWidth:a.maxWidth});const m=document.createElement("span");bt(m,pt(96)),m.appendChild(sn(s&&s.availability));const{label:f}=ie({checked:!!o,title:o?"已启用":"已禁用",ariaLabel:o?"已启用":"已禁用",inputAttrs:{"data-enable-key":i}}),k=document.createElement("span");bt(k,pt(72)),k.appendChild(f);const{label:L}=ie({checked:!!c,title:c?"首页显示":"首页隐藏",ariaLabel:c?"首页显示":"首页隐藏",inputAttrs:{"data-home-key":i}}),M=document.createElement("span");bt(M,pt(72)),M.appendChild(L);const yt=document.createElement("span");bt(yt,pt(72)),Xe(yt,{dirAttr:"data-sort",keyAttr:"data-site-key",key:i,disabledUp:n===0,disabledDown:n===x.length-1}),r.appendChild(l),r.appendChild(u),r.appendChild(g),r.appendChild(m),r.appendChild(k),r.appendChild(M),r.appendChild(yt),p.appendChild(r)})}p&&ot([]);const A=F(P),gs=async(t,e)=>{const{resp:a,data:s}=await I("/dashboard/video/source/sites/status",{key:t,enabled:e?"1":"0"});return a.ok&&s&&s.success?{ok:!0,enabled:!!s.enabled}:{ok:!1,message:s&&s.message||"保存失败"}},rn=async(t,e)=>{const{resp:a,data:s}=await I("/dashboard/video/source/sites/home",{key:t,home:e?"1":"0"});return a.ok&&s&&s.success?{ok:!0,home:!!s.home}:{ok:!1,message:s&&s.message||"保存失败"}},on=async t=>{const e=(Array.isArray(t)?t:[]).map(n=>n&&n.key||"").filter(Boolean),{resp:a,data:s}=await I("/dashboard/video/source/sites/order",{order:JSON.stringify(e)});return a.ok&&s&&s.success?{ok:!0}:{ok:!1,message:s&&s.message||"保存失败"}},dn=async t=>{const e=await Dt(),a=q(e);if(!a)return{ok:!1,message:"CatPawOpen 接口地址未设置"};const s=(Array.isArray(t)?t:[]).map(u=>typeof u=="string"?u.trim():"").filter(Boolean);if(!s.length)return{ok:!0,sites:x||[],results:{}};const n=new Map;(x||[]).forEach(u=>{u&&u.key&&n.set(u.key,u)});const r=u=>u?Array.isArray(u)?u:Array.isArray(u.list)?u.list:u.data&&Array.isArray(u.data)?u.data:u.data&&Array.isArray(u.data.list)?u.data.list:u.data&&Array.isArray(u.data.vod_list)?u.data.vod_list:u.data&&Array.isArray(u.data.items)?u.data.items:[]:[],i=u=>{const g=typeof u=="string"?u.trim():"";if(!g)return"";try{const m=g.startsWith("http://")||g.startsWith("https://")?new URL(g):null,f=m?m.pathname:g;if(f.indexOf("/spider/")===0){const k=f.split("/").filter(Boolean);return k.length>=2?k[1]:""}}catch{}if(g.indexOf("/spider/")===0){const m=g.split("/").filter(Boolean);return m.length>=2?m[1]:""}return""},o={};for(let u=0;u<s.length;u+=1){const g=s[u],m=n.get(g);if(!m||!m.api){o[g]="unknown";continue}try{if(i(m.api)==="baseset"){const yt=await Vs({apiBase:a,path:"website"});o[g]=yt?"valid":"invalid";continue}const k=String(m.api||"").trim().replace(/\/+$/,"").replace(/^\//,""),L=await nt({apiBase:a,path:`${k}/search`,method:"POST",body:{wd:"斗破",page:1}});if(L&&typeof L.statusCode=="number"&&L.statusCode>=400){o[g]="invalid";continue}const M=r(L);o[g]=M.length>0?"valid":"unknown"}catch{o[g]="invalid"}}const{resp:c,data:l}=await I("/dashboard/video/source/sites/check",{results:JSON.stringify(o)});return c.ok&&l&&l.success?{ok:!0,sites:Array.isArray(l.sites)?l.sites:[],results:l.results||{}}:{ok:!1,message:l&&l.message||"检测失败"}};Et&&Et.addEventListener("change",()=>{const t=!!Et.checked;x.forEach(e=>{const a=e&&e.key||"";a&&(t?V.add(a):V.delete(a))}),ot(x)});const ms=async t=>{const e=x.map(a=>a&&a.key||"").filter(a=>a&&V.has(a));if(e.length){it&&(it.disabled=!0),at&&(at.disabled=!0),st&&(st.disabled=!0),A("","保存中...");try{let a=0,s=0;for(let n=0;n<e.length;n+=1){const r=await gs(e[n],t);r&&r.ok?a+=1:s+=1}x=x.map(n=>!n||!n.key||!V.has(n.key)?n:{...n,enabled:t}),ot(x),s<=0?(A("success","保存成功"),jt(A,1200)):a>0?A("error",`部分失败：${s}/${e.length}`):A("error","保存失败")}catch{A("error","保存失败")}finally{it&&(it.disabled=!1),at&&(at.disabled=!1),st&&(st.disabled=!1)}}},cn=async()=>{const t=x.map(e=>e&&e.key||"").filter(e=>e&&V.has(e));if(t.length){it&&(it.disabled=!0),at&&(at.disabled=!0),st&&(st.disabled=!0),A("",`检测中... 0/${t.length}`);try{let e=0,a=0,s=0;for(let n=0;n<t.length;n+=1){A("",`检测中... ${n+1}/${t.length}`);const r=await dn([t[n]]);if(r&&r.ok){const i=Array.isArray(r.sites)?r.sites:[];ot(i);const o=r.results&&r.results[t[n]]?ua(r.results[t[n]]):"unchecked";o==="valid"?e+=1:o==="invalid"?a+=1:o==="unknown"&&(s+=1)}else a+=1}A(a>0?"error":"success",`检测完成：有效${e} 无效${a} 未知${s}`)}catch{A("error","检测失败")}finally{it&&(it.disabled=!1),at&&(at.disabled=!1),st&&(st.disabled=!1)}}};if(it&&it.addEventListener("click",t=>{t.preventDefault(),cn()}),at&&at.addEventListener("click",t=>{t.preventDefault(),ms(!0)}),st&&st.addEventListener("click",t=>{t.preventDefault(),ms(!1)}),p){const t=async({target:e,keyAttr:a,save:s,updateSite:n})=>{if(!e||!e.getAttribute)return;const r=e.getAttribute(a)||"";if(!r)return;const i=!!e.checked,o=!i;e.disabled=!0,A("","保存中...");try{const c=await(typeof s=="function"?s(r,i):null);c&&c.ok?(x=x.map(l=>!l||l.key!==r?l:typeof n=="function"?n(l,c):l),A("success","保存成功"),ot(x),jt(A,1200)):(e.checked=o,A("error",c&&c.message||"保存失败"))}catch{e.checked=o,A("error","保存失败")}finally{e.disabled=!1}};p.addEventListener("change",e=>{const a=e.target;if(!a||!a.matches||!a.matches('input[type="checkbox"][data-select-key]'))return;const s=a.getAttribute("data-select-key")||"";s&&(a.checked?V.add(s):V.delete(s),us(),ps())}),p.addEventListener("click",async e=>{const a=e.target;if(!a||!a.closest)return;const s=a.closest("button[data-sort][data-site-key]");if(!s)return;const n=s.getAttribute("data-sort")||"",r=s.getAttribute("data-site-key")||"";if(!r||n!=="up"&&n!=="down")return;const i=x.findIndex(l=>l&&l.key===r);if(i<0)return;const o=n==="up"?i-1:i+1;if(o<0||o>=x.length)return;x=Ye(x,i,o),ot(x),s.disabled=!0,A("","保存中...");try{const l=await on(x);l&&l.ok?(A("success","保存成功"),jt(A,1200)):A("error",l&&l.message||"保存失败")}catch{A("error","保存失败")}finally{s.disabled=!1}}),p.addEventListener("change",async e=>{const a=e.target;!a||!a.matches||a.matches('input[type="checkbox"][data-enable-key]')&&await t({target:a,keyAttr:"data-enable-key",save:gs,updateSite:(s,n)=>({...s,enabled:!!n.enabled})})}),p.addEventListener("change",async e=>{const a=e.target;!a||!a.matches||a.matches('input[type="checkbox"][data-home-key]')&&await t({target:a,keyAttr:"data-home-key",save:rn,updateSite:(s,n)=>({...s,home:!!n.home})})})}Mt&&(Mt.addEventListener("click",async t=>{const e=t.target;if(!e||!e.closest)return;const a=e.closest("button[data-pan-sort][data-pan-key]");if(!a)return;const s=a.getAttribute("data-pan-sort")||"",n=a.getAttribute("data-pan-key")||"";if(!n||s!=="up"&&s!=="down")return;const r=E.findIndex(u=>u&&u.key===n);if(r<0)return;const i=s==="up"?r-1:r+1;if(i<0||i>=E.length)return;const o=E.slice();E=Ye(E,r,i),Ct(E);const l=u=>{E=o,Ct(E),St("error",u||"保存失败")};a.disabled=!0,St("","保存中...");try{const u=await ss(E);u&&u.ok?(Ct(u.pans),St("success","保存成功"),jt(St,1200)):l(u&&u.message||"保存失败")}catch{l("保存失败")}finally{a.disabled=!1}}),Mt.addEventListener("change",async t=>{const e=t.target;if(!e||!e.matches||!e.matches('input[type="checkbox"][data-pan-enable-key]'))return;const a=e.getAttribute("data-pan-enable-key")||"";if(!a)return;const s=!!e.checked,n=!s,r=E.slice();E=E.map(o=>!o||o.key!==a?o:{...o,enable:s});const i=o=>{e.checked=n,E=r,Ct(E),St("error",o||"保存失败")};e.disabled=!0,St("","保存中...");try{const o=await ss(E);o&&o.ok?(Ct(o.pans),St("success","保存成功"),jt(St,1200)):i(o&&o.message||"保存失败")}catch{i("保存失败")}finally{e.disabled=!1}}));const ys=async()=>{const t=await kt("/dashboard/video/source/sites");return t&&Array.isArray(t.sites)?t.sites:[]},ln=async()=>{const t=await kt("/dashboard/video/source/settings");return{videoSourceUrl:t&&t.videoSourceUrl||""}},un=async()=>{if(!(j.video||S.video)){S.video=!0;try{const t=document.getElementById("videoSourceUrl"),e=await ln();t&&e&&typeof e.videoSourceUrl=="string"&&(t.value=e.videoSourceUrl),Ct(await la()),ot(await ys()),j.video=!0}finally{S.video=!1}}},pn=async()=>{if(!(j.pan||S.pan)){S.pan=!0;try{const t=rt[0]?rt[0].key:"";t&&!Y&&(Y=t),oa(),Zt(),await ia(Y),da(),j.pan=!0}finally{S.pan=!1}}},gn=async()=>{if(!(j.interface||S.interface)){S.interface=!0;try{const t=await bs();if(t){const e=document.getElementById("catPawOpenSettingsForm"),a=e?e.querySelector('input[name="catPawOpenApiBase"]'):null;a&&(a.value=t.catPawOpenApiBase||"");const s=$?$.querySelector('input[name="openListApiBase"]'):null;s&&(s.value=t.openListApiBase||"");const n=$?$.querySelector('input[name="openListToken"]'):null;n&&(n.value=t.openListToken||""),he&&(he.checked=!!t.openListQuarkTvMode);const r=$?$.querySelector('input[name="openListQuarkTvMount"]'):null;r&&(r.value=t.openListQuarkTvMount||""),fe&&(fe.checked=!!t.goProxyEnabled),xe&&(xe.checked=!!t.goProxyAutoSelect),Z=Wa($s(t.goProxyServersJson||t.goProxyServers||"[]")),Re(),await sa(a&&typeof a.value=="string"?a.value:"")}j.interface=!0}finally{S.interface=!1}}},ce=document.getElementById("siteSettingsForm"),mn=document.getElementById("saveStatus"),Te=F(mn);X(ce,()=>{ce.addEventListener("submit",async t=>{t.preventDefault(),await Ae(ce,"pending",async()=>{Te("","保存中...");try{const{resp:e,data:a}=await I(ce.action,oe(ce));e.ok&&a&&a.success?Te("success","保存成功"):Te("error",a&&a.message||"保存失败")}catch{Te("error","保存失败")}})})});const At=document.getElementById("catPawOpenSettingsForm"),yn=document.getElementById("catPawOpenSaveStatus"),gt=F(yn);X(At,()=>{At.addEventListener("submit",async t=>{t.preventDefault(),await Ae(At,"pending",async()=>{gt("","保存中...");try{const e=At.querySelector('input[name="catPawOpenApiBase"]'),a=e&&typeof e.value=="string"?e.value:"",{resp:s,data:n}=await I(At.action,oe(At));if(!(s.ok&&n&&n.success)){gt("error",n&&n.message||"保存失败");return}if(!q(a)){await sa(a),gt("success","保存成功");return}if(n&&n.apiBaseChanged===!0)try{const l=await Zs();l&&l.ok===!1&&gt("error","CatPawOpen 同步失败")}catch{gt("error","CatPawOpen 同步失败")}const i=document.getElementById("catPawOpenRemoteSettings");if(!!!(i&&!i.classList.contains("hidden"))){await sa(a),gt("success","保存成功");return}const c=await _s(a);c&&c.ok===!1?gt("error","CatPawOpen 同步失败"):gt("success","保存成功")}catch{gt("error","保存失败")}})})}),X($,()=>{let t=!1;$.addEventListener("submit",async e=>{if(e.preventDefault(),!t){t=!0,Kt("","保存中...");try{const a=$.querySelector('input[name="openListApiBase"]'),s=$.querySelector('input[name="openListToken"]'),n=$.querySelector('input[name="openListQuarkTvMount"]'),r=!!(he&&he.checked),i=a&&typeof a.value=="string"?a.value:"",o=s&&typeof s.value=="string"?s.value:"",c=n&&typeof n.value=="string"?n.value:"",l=qa(i);a&&(a.value=l);const u=Va(c);n&&(n.value=u);const g=!!l||!!String(o||"").trim()||!!u||r,{resp:m,data:f}=await I($.action,oe($));if(!!!(m&&m.ok&&f&&f.success)){Kt("error",f&&f.message||"保存失败");return}if(g)try{await Ws({apiBase:l,token:o,mountPath:u}),Kt("success","保存成功")}catch(L){const M=L&&L.message?String(L.message):"验证失败";Kt("error",`${M}（已保存）`)}else Kt("success","保存成功")}catch{Kt("error","保存失败")}finally{t=!1}}})}),X(We,()=>{Ia&&ve&&Ia.addEventListener("click",()=>{const t=Le(ve.value);if(!t){Qt("error","服务器地址不是合法 URL");return}if(Qt("",""),Z.some(a=>(a&&a.base?a.base.toLowerCase():"")===t.toLowerCase())){ve.value="";return}Z=Wa(Z.concat([{base:t,pans:{baidu:!0,quark:!0}}])),Re(),ve.value=""}),We.addEventListener("submit",async t=>{if(t.preventDefault(),!ea){ea=!0,Qt("","保存中...");try{const e=JSON.stringify(Z||[]);Ra&&(Ra.value=e);const{resp:a,data:s}=await I(We.action,{goProxyEnabled:fe&&fe.checked?"1":"0",goProxyAutoSelect:xe&&xe.checked?"1":"0",goProxyServersJson:e});a.ok&&s&&s.success?Qt("success","保存成功"):Qt("error",s&&s.message||"保存失败")}catch{Qt("error","保存失败")}finally{ea=!1}}})});const Yt=document.getElementById("videoSourceForm"),hn=document.getElementById("videoSourceSaveStatus"),W=F(hn),fn=async()=>{const t=await Dt(),e=q(t);if(!e){W("error","CatPawOpen 接口地址未设置");return}W("","导入中...");try{const a=await nt({apiBase:e,path:"full-config",method:"GET"}),n=(a&&a.video&&Array.isArray(a.video.sites)?a.video.sites:[]).map(o=>({key:o&&typeof o.key=="string"?o.key:"",name:o&&typeof o.name=="string"?o.name:"",api:o&&typeof o.api=="string"?o.api:"",type:o&&typeof o.type=="number"?o.type:void 0})).filter(o=>o.key&&o.api);if(!n.length){W("error","未获取到站源");return}const{resp:r,data:i}=await I("/dashboard/video/source/sites/import",{sites:JSON.stringify(n)});if(r.ok&&i&&i.success&&Array.isArray(i.sites)){ot(i.sites),W("success","导入成功"),jt(W,1200);return}W("error",i&&i.message||"导入失败")}catch{W("error","导入失败")}};X(Tt,()=>{Tt.addEventListener("click",async t=>{t.preventDefault(),await Ae(Tt,"pending",async()=>{Tt.disabled=!0,Tt.classList.add("opacity-60","cursor-not-allowed");try{await fn()}finally{Tt.disabled=!1,Tt.classList.remove("opacity-60","cursor-not-allowed")}})})}),X(Yt,()=>{const t=Yt.querySelector('button[type="submit"]');Yt.addEventListener("submit",async e=>{e.preventDefault(),await Ae(Yt,"pending",async()=>{t&&(t.disabled=!0,t.classList.add("opacity-60","cursor-not-allowed")),W("","保存中...");try{const{resp:a,data:s}=await I(Yt.action,oe(Yt));if(!(a.ok&&s&&s.success)){W("error",s&&s.message||"保存失败");return}W("success","保存成功"),s&&Array.isArray(s.sites)?ot(s.sites):ot(await ys()),s&&Array.isArray(s.pans)?Ct(s.pans):Ct(await la()),jt(W,1200)}catch{W("error","保存失败")}finally{t&&(t.disabled=!1,t.classList.remove("opacity-60","cursor-not-allowed"))}})})});const Ht=document.getElementById("openAddUser"),Ut=document.getElementById("addUserForm"),xn=document.getElementById("addUserStatus"),pa=document.getElementById("addUserName"),hs=document.getElementById("addUserPassword"),fs=document.getElementById("addUserRole"),vn=document.getElementById("addUserCatApiBase"),bn=document.getElementById("addUserCatProxy"),te=document.getElementById("confirmAddUser"),Bt=document.getElementById("userCount"),Pt=document.getElementById("userTableBody"),wn=t=>{if(t)for(;t.firstChild;)t.removeChild(t.firstChild)},kn=(t,e)=>h("span",{className:t,text:e}),le=(t,e,a)=>{t&&(wn(t),t.appendChild(kn(e,a)))},Sn=t=>t==="admin"?{className:"tag-yellow",text:"管理员"}:t==="shared"?{className:"tag-green",text:"共享"}:{className:"tag-gray",text:"用户"},xs=(t,e)=>{const{className:a,text:s}=Sn(e);le(t,a,s)},je=(t,e,{whenSet:a,whenEmpty:s})=>{const n=typeof e=="string"?e.trim().length>0:!!e,r=n?a.className:s.className,i=n?a.text:s.text;le(t,r,i)},Cn=t=>{if(!t)return;const e=t.getAttribute("data-username")||"",a=t.getAttribute("data-role")||"user",s=t.getAttribute("data-status")||"active",n=t.getAttribute("data-cat-api-base")||"",r=t.getAttribute("data-cat-proxy")||"",i=t.querySelector('td[data-col="username"]')||t.querySelector("td");i&&(i.textContent=e),xs(t.querySelector('td[data-col="role"]'),a),je(t.querySelector('td[data-col="catApiBase"]'),n,{whenSet:{className:"tag-green",text:"已设置"},whenEmpty:{className:"tag-red",text:"未设置"}}),je(t.querySelector('td[data-col="catProxy"]'),r,{whenSet:{className:"tag-yellow",text:"已设置"},whenEmpty:{className:"tag-green",text:"未设置"}}),ga(t.querySelector('td[data-col="status"]'),s)},ga=(t,e)=>{t&&(e==="active"?le(t,"tag-green","正常"):e==="banned"?le(t,"tag-red","封禁"):le(t,"tag-gray",e||""))},vs=t=>{if(!Pt)return;const e=document.createElement("tr");e.setAttribute("data-username",t.username||""),e.setAttribute("data-role",t.role||"user"),e.setAttribute("data-status",t.status||"active"),e.setAttribute("data-cat-api-base",t.cat_api_base||t.catApiBase||""),e.setAttribute("data-cat-proxy",t.cat_proxy||t.catProxy||"");const a=document.createElement("td");a.className="px-3 py-2 font-semibold whitespace-nowrap",a.setAttribute("data-col","username"),a.textContent=t.username||"";const s=document.createElement("td");s.className="px-3 py-2 whitespace-nowrap",s.setAttribute("data-col","role"),xs(s,t.role||"user");const n=document.createElement("td");n.className="px-3 py-2 whitespace-nowrap",n.setAttribute("data-col","status"),ga(n,t.status||"active");const r=document.createElement("td");r.className="px-3 py-2 whitespace-nowrap",r.setAttribute("data-col","catApiBase"),je(r,e.getAttribute("data-cat-api-base")||"",{whenSet:{className:"tag-green",text:"已设置"},whenEmpty:{className:"tag-red",text:"未设置"}});const i=document.createElement("td");i.className="px-3 py-2 whitespace-nowrap",i.setAttribute("data-col","catProxy"),je(i,e.getAttribute("data-cat-proxy")||"",{whenSet:{className:"tag-yellow",text:"已设置"},whenEmpty:{className:"tag-green",text:"未设置"}});const o=document.createElement("td");o.className="px-3 py-2 whitespace-nowrap";const c=document.createElement("div");c.className="action-group";const l=(u,g,m)=>{const f=document.createElement("button");return f.type="button",f.className=`action-btn ${u}`,f.setAttribute("data-action",g),f.textContent=m,f};if(c.appendChild(l("blue","edit","修改")),t.role!=="admin"){const u=t.status==="active"?"封禁":"解封";c.appendChild(l("rose","ban",u)),c.appendChild(l("red","delete","删除"))}o.appendChild(c),e.appendChild(a),e.appendChild(s),e.appendChild(r),e.appendChild(i),e.appendChild(n),e.appendChild(o),Pt.appendChild(e)},En=async()=>{if(!(j.user||S.user)&&Pt){S.user=!0;try{const t=await kt("/dashboard/user/list");if(!(t&&Array.isArray(t.users)))return;if(Pt.innerHTML="",t.users.forEach(e=>vs(e||{})),Bt){const e=typeof t.userCount=="number"?t.userCount:Array.isArray(t.users)?t.users.length:0;Bt.textContent=String(e)}j.user=!0}finally{S.user=!1}}},bs=async()=>kt("/dashboard/site/settings"),ma=(t,e)=>{const a=document.querySelector(`input[name="${t}"]`);a&&(a.value=e!=null?String(e):"")},ya=(t,e)=>{const a=document.getElementById(t);if(!a)return;a.value=e!=null?String(e):"";const s=a.parentNode;if(s&&s.classList&&s.classList.contains("custom-dropdown")){const n=s.querySelector(".custom-dropdown-btn"),r=s.querySelector(".custom-dropdown-list"),i=a.options[a.selectedIndex];n&&(n.textContent=i&&i.text||"请选择"),r&&r.querySelectorAll(".custom-dropdown-item").forEach(o=>{const c=o&&o.dataset?o.dataset.value:"";o.classList.toggle("active",c===a.value)})}a.dispatchEvent(new Event("change",{bubbles:!0}))},An=async()=>{if(!(j.site||S.site)){S.site=!0;try{const t=await bs();if(!t)return;ma("siteName",t.siteName||""),ma("doubanDataCustom",t.doubanDataCustom||""),ma("doubanImgCustom",t.doubanImgCustom||""),ya("doubanDataSelect",t.doubanDataProxy||"direct"),ya("doubanImgSelect",t.doubanImgProxy||"direct-browser"),j.site=!0}finally{S.site=!1}}};let ha=[],z=[],dt="",$t=!1;const ee=F(Os),Bn=async()=>kt("/dashboard/search/settings"),Pn=async(t,e)=>{const{resp:a,data:s}=await $a("/dashboard/search/settings",{order:t,coverSite:e});if(!a.ok||!s||s.success!==!0)throw new Error(s&&s.message||`HTTP ${a.status}`);return s},De=()=>{if(!vt)return;vt.innerHTML="";const t=Array.isArray(ha)?ha:[];if(!t.length){re(vt);return}const e=new Map;t.forEach(n=>{n&&n.key&&e.set(n.key,n)});const a=(Array.isArray(z)?z:[]).map(n=>e.get(n)).filter(Boolean),s=Ze(a,n=>n&&(n.name||n.key)||"");Ba&&zt(Ba,{width:s.width,minWidth:"80px",maxWidth:s.maxWidth}),Pa&&wt(Pa,96),La&&wt(La,72),a.forEach((n,r)=>{const i=n&&n.key||"",o=h("li",{className:"tv-row"}),c=document.createElement("span");c.className="text-sm font-medium text-gray-800 dark:text-gray-100 truncate",c.textContent=n&&(n.name||n.key)||"",zt(c,{width:s.width,minWidth:"80px",maxWidth:s.maxWidth});const l=document.createElement("span");bt(l,pt(96));const{label:u}=ie({checked:dt===i,disabled:$t,title:dt===i?"已启用":"未启用",ariaLabel:dt===i?"已启用":"未启用",inputAttrs:{"data-cover-key":i}});l.appendChild(u);const g=document.createElement("span");bt(g,pt(72)),Xe(g,{dirAttr:"data-search-sort",keyAttr:"data-site-key",key:i,disabledUp:$t||r===0,disabledDown:$t||r===a.length-1}),o.appendChild(c),o.appendChild(l),o.appendChild(g),vt.appendChild(o)})},Ln=async()=>{if(!(j.search||S.search)&&vt){S.search=!0,ee("","加载中...");try{const t=await Bn();if(!t){ee("error","加载失败");return}ha=Array.isArray(t.sites)?t.sites:[];const e=t.search&&typeof t.search=="object"?t.search:{};z=Array.isArray(e.order)?e.order:[],dt=typeof e.coverSite=="string"?e.coverSite:"",De(),j.search=!0,ee("","")}finally{S.search=!1}}};if(vt){const t=async({nextOrder:e,nextCoverSite:a})=>{if(!$t){$t=!0,ee("","保存中...");try{z=Array.isArray(e)?e:z,dt=typeof a=="string"?a:dt,De();const s=await Pn(z,dt),n=s&&s.search&&typeof s.search=="object"?s.search:{};z=Array.isArray(n.order)?n.order:z,dt=typeof n.coverSite=="string"?n.coverSite:dt,ee("success","已保存")}catch(s){ee("error",s&&s.message||"保存失败")}finally{$t=!1,De()}}};vt.addEventListener("change",async e=>{const a=e&&e.target?e.target:null,s=a&&a.closest?a.closest("input[data-cover-key]"):null;if(!s)return;const n=(s.getAttribute("data-cover-key")||"").trim();if(n){if(!s.checked){De();return}await t({nextOrder:z,nextCoverSite:n})}}),vt.addEventListener("click",async e=>{const a=e&&e.target?e.target:null,s=a&&a.closest?a.closest("button[data-search-sort][data-site-key]"):null;if(!s)return;const n=(s.getAttribute("data-search-sort")||"").trim(),r=(s.getAttribute("data-site-key")||"").trim();if(!n||!r||$t)return;const i=z.findIndex(l=>l===r);if(i<0)return;const o=n==="up"?i-1:i+1;if(o<0||o>=z.length)return;const c=Ye(z,i,o);await t({nextOrder:c,nextCoverSite:dt})})}let R=[],H=[],U=[],N=[],ct=!1;const _t=t=>{const e=typeof t=="string"?t:"";return e?e.replace(/\\\\(?=[dDsSwWbB.()[\]{}+*?^$|\\\-_/])/g,"\\"):""},ws=t=>{const e=typeof t=="string"?t.trim():"";if(!e)return null;if(e.startsWith("{")&&e.endsWith("}"))try{const a=JSON.parse(e);if(a&&typeof a=="object"&&typeof a.pattern=="string"&&a.pattern.trim())return{pattern:_t(String(a.pattern||"").trim()),replace:typeof a.replace=="string"?a.replace:"",flags:typeof a.flags=="string"?a.flags:""}}catch{}if(e.startsWith("/")&&e.lastIndexOf("/")>0){const a=e.lastIndexOf("/"),s=e.slice(1,a),n=e.slice(a+1);if(s.trim())return{pattern:_t(s.trim()),replace:"",flags:n||""}}return{pattern:_t(e),replace:"",flags:""}},Rn=t=>{const e=t&&typeof t.pattern=="string"?t.pattern.trim():"",a=_t(e);if(!a)return"";const s=t&&typeof t.replace=="string"?t.replace:"",n=t&&typeof t.flags=="string"?t.flags.trim():"",r={pattern:a,replace:s||""};n&&(r.flags=n);try{return JSON.stringify(r)}catch{return""}},fa=t=>{const e=typeof t=="string"?t.trim():"";if(!e)return null;if(e.startsWith("/")&&e.lastIndexOf("/")>0){const a=e.lastIndexOf("/"),s=_t(e.slice(1,a).trim()),n=e.slice(a+1).trim();return s?{pattern:s,flags:n}:null}return{pattern:_t(e)}},ks=(t,{defaultFlags:e="",forceGlobal:a=!1}={})=>{const s=fa(t);if(!s||!s.pattern)return null;let r=(typeof s.flags=="string"?s.flags:"")||(typeof e=="string"?e:"");a&&!r.includes("g")&&(r+="g");try{return new RegExp(s.pattern,r)}catch{return null}},He=t=>{const e=fa(t);if(!e||!e.pattern)return"";const a=typeof e.flags=="string"?e.flags.trim():"";return a?`/${e.pattern}/${a}`:e.pattern},w=(t,e,a)=>Ua(t,e,a),Lt=F(Ts),ue=F(js),In=t=>{const e=typeof t=="string"?t:"";return e?e.replace(/\\(\d+)/g,"$$$1"):""},Ss=()=>{if(!we)return;const t=(we.value||"").trim();if(!t){Lt("","请输入文件名");return}const e=Array.isArray(R)?R:[];if(!e.length){Lt("error","无匹配规则");return}let a=t;(Array.isArray(H)?H:[]).forEach(r=>{const i=typeof r=="string"?r.trim():"";if(!i)return;const o=ks(i,{defaultFlags:"g",forceGlobal:!0});o&&(a=a.replace(o,""))}),a=a.replace(/\s+/g," ").trim();const n=[];for(let r=0;r<e.length;r+=1){const i=e[r]&&typeof e[r]=="object"?e[r]:null,o=i&&typeof i.pattern=="string"?i.pattern.trim():"";if(!o)continue;const c=i&&typeof i.flags=="string"&&i.flags.trim()?i.flags.trim():"i";let l=null;try{l=new RegExp(o,c)}catch{n.push(`#${r+1} 正则无效`);continue}if(!l.test(a))continue;const u=In(i&&typeof i.replace=="string"?i.replace:"");if(!u){Lt("success",`命中第 ${r+1} 条：未设置 replace（无改写）`);return}let g="";try{g=a.replace(l,u)}catch{g=""}if(!g){Lt("error",`命中第 ${r+1} 条，但改写失败`);return}Lt("success",`命中第 ${r+1} 条：${g}`);return}if(n.length){Lt("error",`未命中（${n.join("，")}）`);return}Lt("error","未命中")},Cs=()=>{if(!Se)return;const t=(Se.value||"").trim();if(!t){ue("","请输入文本");return}const e=Array.isArray(U)?U:[],a=Array.isArray(N)?N:[];if(!e.length&&!a.length){ue("error","无清洗规则");return}let s=String(t);const n=[];e.forEach(i=>{const o=typeof i=="string"?i.trim():"";o&&o.split(/[、,，\s]+/g).map(c=>c.trim()).filter(Boolean).forEach(c=>n.push(c))}),n.forEach(i=>{i&&(s=s.split(i).join(""))});const r=[];if(a.forEach((i,o)=>{const c=typeof i=="string"?i.trim():"";if(c)try{const l=ks(c,{defaultFlags:"g",forceGlobal:!0});if(!l)throw new Error("invalid");s=s.replace(l,"")}catch{r.push(`#${o+1} 正则无效`)}}),r.length){ue("error",`清洗失败（${r.join("，")}）`);return}ue("success",`清洗后：${s}`)},On=async()=>kt("/dashboard/magic/settings"),Nn=async(t,e,a,s)=>{const n=Array.isArray(t)?t:[],{resp:r,data:i}=await $a("/dashboard/magic/settings",{episodeCleanRegex:n[0]||"",episodeCleanRegexRules:n,episodeRules:e,aggregateRules:a,aggregateRegexRules:s});if(!r.ok||!i||i.success!==!0)throw new Error(i&&i.message||`HTTP ${r.status}`);return i},Ue=(t,e,a)=>{if(!t)return;t.innerHTML="";const s=Array.isArray(e)?e:[];if(!s.length){re(t);return}s.forEach((n,r)=>{const i=h("li",{className:"tv-row"}),o=h("span",{className:Ee.mutedMonoXs,text:`${r+1}.`});if(a==="episode"){const l=n&&typeof n=="object"?n:{pattern:"",replace:""},u=h("div",{className:"flex items-center gap-2 min-w-0"});_(u,{flex:"0 0 50%",maxWidth:"50%",minWidth:"0"});const g=h("input",{className:"tv-field min-w-0"});_(g,{flex:"5 1 0",minWidth:"0"}),g.value=typeof l.pattern=="string"?l.pattern:"",g.disabled=ct,g.setAttribute("data-magic-kind",a),g.setAttribute("data-magic-idx",String(r)),g.setAttribute("data-magic-field","pattern");const m=h("input",{className:"tv-field min-w-0"});_(m,{flex:"1 1 0",minWidth:"0"}),m.value=typeof l.replace=="string"?l.replace:"",m.placeholder="replace（可空）",m.disabled=ct,m.setAttribute("data-magic-kind",a),m.setAttribute("data-magic-idx",String(r)),m.setAttribute("data-magic-field","replace"),u.appendChild(g),u.appendChild(m),i.appendChild(o),i.appendChild(u)}else{const l=h("div",{className:"min-w-0"});_(l,{flex:"0 0 50%",maxWidth:"50%",minWidth:"0"});const u=h("input",{className:"tv-field min-w-0"});u.value=typeof n=="string"?n:"",u.disabled=ct,u.setAttribute("data-magic-kind",a),u.setAttribute("data-magic-idx",String(r)),l.appendChild(u),i.appendChild(o),i.appendChild(l)}if(a==="episode"){const l=h("button",{className:"action-btn green",text:"保存"});l.type="button",l.disabled=ct,l.setAttribute("data-magic-save",a),l.setAttribute("data-magic-idx",String(r)),i.appendChild(l)}const c=h("button",{className:"action-btn red",text:"删除"});c.type="button",c.disabled=ct,c.setAttribute("data-magic-del",a),c.setAttribute("data-magic-idx",String(r)),i.appendChild(c),t.appendChild(i)})},et=()=>{Ue(ke,H,"episodeCleanRegex"),Ue(se,R,"episode"),Ue(ne,U,"aggregate"),Ue(Ce,N,"aggregateRegex"),Lt("",""),ue("","")},mt=async()=>{if(!ct){ct=!0,w(qt,"","保存中..."),w(Ft,"","保存中..."),w(Vt,"","保存中..."),w(Wt,"","保存中...");try{const t=(Array.isArray(R)?R:[]).map(Rn).filter(Boolean),e=await Nn(H,t,U,Array.isArray(N)?N:[]);H=Array.isArray(e.episodeCleanRegexRules)?e.episodeCleanRegexRules:typeof e.episodeCleanRegex=="string"&&e.episodeCleanRegex.trim()?[e.episodeCleanRegex.trim()]:H,R=Array.isArray(e.episodeRules)?e.episodeRules.map(ws).filter(Boolean):R,U=Array.isArray(e.aggregateRules)?e.aggregateRules:U,N=Array.isArray(e.aggregateRegexRules)?e.aggregateRegexRules:N,et(),w(qt,"success","已保存"),w(Ft,"success","已保存"),w(Vt,"success","已保存"),w(Wt,"success","已保存")}catch(t){const e=t&&t.message||"保存失败";w(qt,"error",e),w(Ft,"error",e),w(Vt,"error",e),w(Wt,"error",e)}finally{ct=!1,et()}}},Mn=async()=>{if(!(j.magic||S.magic)&&!(!se&&!ne)){S.magic=!0,w(qt,"","加载中..."),w(Ft,"","加载中..."),w(Vt,"","加载中..."),w(Wt,"","加载中...");try{const t=await On();if(!t){w(qt,"error","加载失败"),w(Ft,"error","加载失败"),w(Vt,"error","加载失败"),w(Wt,"error","加载失败");return}R=Array.isArray(t.episodeRules)?t.episodeRules.map(ws).filter(Boolean):[],H=Array.isArray(t.episodeCleanRegexRules)?t.episodeCleanRegexRules:typeof t.episodeCleanRegex=="string"&&t.episodeCleanRegex.trim()?[t.episodeCleanRegex.trim()]:[],U=Array.isArray(t.aggregateRules)?t.aggregateRules:[],N=Array.isArray(t.aggregateRegexRules)?t.aggregateRegexRules:[],et(),w(qt,"",""),w(Ft,"",""),w(Vt,"",""),w(Wt,"",""),j.magic=!0}finally{S.magic=!1}}};Oa&&ze&&Je&&Oa.addEventListener("click",async()=>{const t=fa(ze.value||"");if(!t)return;const e=(Je.value||"").trim();ze.value="",Je.value="",R=(Array.isArray(R)?R:[]).concat([{pattern:t.pattern,replace:e,flags:t.flags||""}]),et(),await mt()}),Na&&Na.addEventListener("click",()=>Ss()),we&&we.addEventListener("keydown",t=>{if(!t)return;(t.key||"")==="Enter"&&(t.preventDefault(),Ss())}),Ma&&Ge&&Ma.addEventListener("click",async()=>{const t=He(Ge.value||"");t&&(Ge.value="",H=(Array.isArray(H)?H:[]).concat([t]),et(),await mt())}),Ta&&Qe&&Ta.addEventListener("click",async()=>{const t=(Qe.value||"").trim();t&&(Qe.value="",U=(Array.isArray(U)?U:[]).concat([t]),et(),await mt())}),Da&&Ke&&Da.addEventListener("click",async()=>{const t=He(Ke.value||"");t&&(Ke.value="",N=(Array.isArray(N)?N:[]).concat([t]),et(),await mt())}),ja&&ja.addEventListener("click",()=>Cs()),Se&&Se.addEventListener("keydown",t=>{if(!t)return;(t.key||"")==="Enter"&&(t.preventDefault(),Cs())});const $e=async t=>{const e=t&&t.target?t.target:null;if(e&&e.closest?e.closest("button[data-magic-save][data-magic-idx]"):null){if(ct)return;await mt();return}const s=e&&e.closest?e.closest("button[data-magic-del][data-magic-idx]"):null;if(!s)return;const n=(s.getAttribute("data-magic-del")||"").trim(),r=Number(s.getAttribute("data-magic-idx")||-1);!Number.isFinite(r)||r<0||ct||(n==="episodeCleanRegex"&&(H=H.filter((i,o)=>o!==r)),n==="episode"&&(R=R.filter((i,o)=>o!==r)),n==="aggregate"&&(U=U.filter((i,o)=>o!==r)),n==="aggregateRegex"&&(N=N.filter((i,o)=>o!==r)),et(),await mt())},_e=async t=>{const e=t&&t.target?t.target:null,a=e&&e.closest?e.closest("input[data-magic-kind][data-magic-idx]"):null;if(!a)return;const s=(a.getAttribute("data-magic-kind")||"").trim(),n=Number(a.getAttribute("data-magic-idx")||-1),r=(a.value||"").trim();if(!(!Number.isFinite(n)||n<0)){if(s==="episode"&&n<R.length){const i=(a.getAttribute("data-magic-field")||"").trim(),o=R[n]&&typeof R[n]=="object"?R[n]:{};i==="replace"?o.replace=r:o.pattern=_t(r),R[n]=o,et();return}if(s==="aggregate"&&n<U.length&&(U[n]=r),s==="aggregateRegex"&&n<N.length){N[n]=He(r),et(),await mt();return}if(s==="episodeCleanRegex"&&n<H.length){H[n]=He(r),et(),await mt();return}await mt()}};ke&&(ke.addEventListener("click",$e),ke.addEventListener("change",_e)),se&&(se.addEventListener("click",$e),se.addEventListener("change",_e)),ne&&(ne.addEventListener("click",$e),ne.addEventListener("change",_e)),Ce&&(Ce.addEventListener("click",$e),Ce.addEventListener("change",_e));function xa(t){return t==="site"?An():t==="user"?En():t==="video"?un():t==="pan"?pn():t==="interface"?gn():t==="search"?Ln():t==="magic"?Mn():null}if(Be&&xa(Be),Ht&&Ut&&pa&&hs&&fs&&vn&&bn&&te){Ht.type="button",Ht.setAttribute("aria-controls","addUserForm"),Ht.setAttribute("aria-expanded","false");const t=F(xn),e=()=>{const s=(pa.value||"").trim().length>0&&(hs.value||"").trim().length>0;te.disabled=!s,te.classList.toggle("active",s)},a=s=>{Ut.hidden=!s,Ht.textContent=s?"取消":"添加用户",Ht.setAttribute("aria-expanded",s?"true":"false"),s?pa.focus():t("",""),e()};a(!1),na(fs),Ht.addEventListener("click",s=>{s.preventDefault(),a(Ut.hidden)}),Ut.addEventListener("input",()=>{t("",""),e()}),Ut.addEventListener("submit",async s=>{if(s.preventDefault(),e(),te.disabled)return;const n=oe(Ut),r=(n.username||"").trim(),i=(n.password||"").trim(),c=(n.role||"").trim()==="shared"?"shared":"user",l=(n.catApiBase||"").trim(),u=(n.catProxy||"").trim();if(!(!r||!i)){te.disabled=!0,te.classList.remove("active"),t("info","添加中...");try{const{resp:g,data:m}=await I("/dashboard/user/add",{username:r,password:i,role:c,catApiBase:l,catProxy:u});if(g.ok&&m.success){if(t("success","添加成功"),vs({username:r,role:c,status:"active",cat_api_base:l,cat_proxy:u}),Ut.reset(),ya("addUserRole","user"),Bt){const f=parseInt(Bt.textContent||"0",10);Bt.textContent=(f+1).toString()}e(),a(!1)}else t("error",m.message||"添加失败"),e()}catch{t("error","添加失败"),e()}}})}Pt&&Pt.addEventListener("click",async t=>{const e=t.target;if(!e||!e.closest)return;const a=e.closest("button[data-action]");if(!a)return;const s=a.getAttribute("data-action");if(!s)return;const n=a.closest("tr");if(!n)return;const r=n.getAttribute("data-username")||"",i=n.getAttribute("data-role")||"";if(!r||i==="admin"&&(s==="ban"||s==="delete"))return;const o=()=>{const c=Pt.querySelector("tr.user-edit-row");c&&c.remove()};if(s==="edit"){const c=Pt.querySelector("tr.user-edit-row"),l=c&&c.getAttribute("data-for")||"";if(c&&l===r){c.remove();return}o();const u=document.createElement("tr");u.className="user-edit-row",u.setAttribute("data-for",r);const g=document.createElement("td");g.colSpan=6,g.className="px-3 py-3";const m=document.createElement("div");m.className="user-edit-box";const f=document.createElement("div");f.className="grid items-center",f.style.gridTemplateColumns="max-content 1fr",f.style.gap="14px 18px";const k=(B,J)=>{const G=document.createElement("span");G.className="text-sm font-medium text-gray-700 dark:text-gray-200 whitespace-nowrap",G.textContent=B;const lt=document.createElement("div");return lt.className="min-w-0",lt.appendChild(J),f.appendChild(G),f.appendChild(lt),lt},L=document.createElement("input");L.type="text",L.placeholder="新用户名",L.className="tv-field";const M=document.createElement("input");M.type="password",M.placeholder="新密码",M.className="tv-field";const yt=(n.getAttribute("data-role")||"").trim()||"user";let O=null;if(i!=="admin"){O=document.createElement("select"),O.className="tv-field";const B=document.createElement("option");B.value="user",B.textContent="用户";const J=document.createElement("option");J.value="shared",J.textContent="共享",O.appendChild(B),O.appendChild(J),O.value=yt==="shared"?"shared":"user"}const Rt=document.createElement("input");Rt.type="text",Rt.placeholder="CatPawOpen 接口地址（可留空）",Rt.className="tv-field";const va=(n.getAttribute("data-cat-api-base")||"").trim();Rt.value=va;const It=document.createElement("input");It.type="text",It.placeholder="CatPawOpen 全局代理地址（可留空）",It.className="tv-field";const ba=(n.getAttribute("data-cat-proxy")||"").trim();It.value=ba,k("新用户名：",L),k("新密码：",M),O&&(k("角色：",O),na(O)),k("Cat接口：",Rt),k("Cat代理：",It);const Fe=document.createElement("div");Fe.className="action-group mt-3";const ht=document.createElement("button");ht.type="button",ht.className="action-btn green",ht.textContent="确定";const pe=document.createElement("button");pe.type="button",pe.className="action-btn gray",pe.textContent="取消";const wa=document.createElement("div");wa.className="text-sm mt-2 hidden";const ft=F(wa),Tn=(B,J)=>{if(!B)return;const G=!!J;B.disabled=!G,B.style.opacity=G?"1":"0.6",B.style.cursor=G?"pointer":"not-allowed"},Ot=()=>{const B=(L.value||"").trim().length>0,J=(M.value||"").trim().length>0,G=!!O&&(O.value||"user")!==(yt==="shared"?"shared":"user"),lt=(Rt.value||"").trim()!==va,ge=(It.value||"").trim()!==ba;Tn(ht,B||J||G||lt||ge)};L.addEventListener("input",()=>{ft("",""),Ot()}),M.addEventListener("input",()=>{ft("",""),Ot()}),O&&O.addEventListener("change",()=>{ft("",""),Ot()}),Rt.addEventListener("input",()=>{ft("",""),Ot()}),It.addEventListener("input",()=>{ft("",""),Ot()}),Ot(),pe.addEventListener("click",()=>u.remove()),ht.addEventListener("click",async()=>{if(Ot(),!ht.disabled){ht.disabled=!0,ft("","保存中...");try{const B={username:r},J=(L.value||"").trim(),G=(M.value||"").trim();if(J&&(B.newUsername=J),G&&(B.newPassword=G),O){const ka=(O.value||"").trim()==="shared"?"shared":"user";ka!==(yt==="shared"?"shared":"user")&&(B.role=ka)}const lt=(Rt.value||"").trim(),ge=(It.value||"").trim();lt!==va&&(B.catApiBase=lt),ge!==ba&&(B.catProxy=ge);const{resp:Es,data:Nt}=await I("/dashboard/user/update",B);if(Es.ok&&Nt.success){const As=Nt.username||r;if(n.setAttribute("data-username",As),O){const Bs=(Nt.role||O.value||"user").trim()==="shared"?"shared":"user";n.setAttribute("data-role",Bs)}Object.prototype.hasOwnProperty.call(Nt,"catApiBase")?n.setAttribute("data-cat-api-base",Nt.catApiBase||""):n.setAttribute("data-cat-api-base",lt),Object.prototype.hasOwnProperty.call(Nt,"catProxy")?n.setAttribute("data-cat-proxy",Nt.catProxy||""):n.setAttribute("data-cat-proxy",ge),Cn(n),ft("success","保存成功"),u.remove()}else ft("error",Nt.message||"保存失败")}catch{ft("error","保存失败")}finally{ht.disabled=!1,Ot()}}}),Fe.appendChild(ht),Fe.appendChild(pe),m.appendChild(f),m.appendChild(Fe),m.appendChild(wa),g.appendChild(m),u.appendChild(g),n.insertAdjacentElement("afterend",u),L.focus();return}if(s==="ban"){a.disabled=!0;try{const{resp:c,data:l}=await I("/dashboard/user/ban",{username:r});if(c.ok&&l.success&&l.status){const u=l.status;n.setAttribute("data-status",u);const g=n.querySelector('td[data-col="status"]');ga(g,u),a.textContent=u==="active"?"封禁":"解封"}else alert(l.message||"操作失败")}catch{alert("操作失败")}finally{a.disabled=!1}}if(s==="delete"){if(!confirm(`确定删除用户：${r}？`))return;a.disabled=!0;try{const{resp:c,data:l}=await I("/dashboard/user/delete",{username:r});if(c.ok&&l.success){if(o(),n.remove(),Bt){const u=parseInt(Bt.textContent||"0",10);Bt.textContent=Math.max(0,u-1).toString()}}else alert(l.message||"删除失败")}catch{alert("删除失败")}finally{a.disabled=!1}}})}const qn={class:"app-shell flex min-h-screen"},Vn={class:"sidebar dashboard-sidebar flex-shrink-0 bg-white/40 dark:bg-[#0d1624] backdrop-blur-xl transition-all duration-300 border-r border-gray-200/50 dark:border-white/10 shadow-lg w-64 p-4 pt-6",style:{"backdrop-filter":"blur(20px)","-webkit-backdrop-filter":"blur(20px)"}},Wn={class:"space-y-1"},zn={key:0,class:"space-y-1"},Jn={class:"flex-1 min-w-0 flex flex-col"},Gn={class:"flex-1 min-w-0 overflow-y-auto p-6 space-y-6"},Qn={key:0,class:"min-h-[300px] flex flex-col items-center justify-center text-gray-600 gap-3"},Kn={key:1,id:"adminSite",class:"admin-panel"},Xn={id:"siteSettingsForm",method:"post",action:"/dashboard/site/save",class:"space-y-4"},Zn=["value"],Yn={id:"doubanSettings",class:"space-y-4"},tr={name:"doubanDataProxy",id:"doubanDataSelect",class:"custom-select tv-field"},er=["selected"],ar=["selected"],sr=["selected"],nr=["selected"],rr=["selected"],ir=["value"],or={name:"doubanImgProxy",id:"doubanImgSelect",class:"custom-select tv-field"},dr=["selected"],cr=["selected"],lr=["selected"],ur=["selected"],pr=["selected"],gr=["selected"],mr=["value"],yr={key:2,id:"adminUser",class:"admin-panel hidden space-y-4"},hr={class:"stat-card"},fr=["textContent"],xr={class:"admin-card"},vr={class:"overflow-x-auto"},br={class:"inline-block w-max align-top"},wr={class:"table-auto w-max text-sm text-left text-gray-700 dark:text-gray-100"},kr={class:"divide-y divide-gray-100 dark:divide-gray-800",id:"userTableBody"},Sr=["data-username","data-role","data-status","data-cat-api-base","data-cat-proxy"],Cr={class:"px-3 py-2 font-semibold whitespace-nowrap"},Er={class:"px-3 py-2 whitespace-nowrap","data-col":"role"},Ar={key:0,class:"tag-yellow"},Br={key:1,class:"tag-green"},Pr={key:2,class:"tag-gray"},Lr={class:"px-3 py-2 whitespace-nowrap","data-col":"catApiBase"},Rr={key:0,class:"tag-green"},Ir={key:1,class:"tag-red"},Or={class:"px-3 py-2 whitespace-nowrap","data-col":"catProxy"},Nr={key:0,class:"tag-yellow"},Mr={key:1,class:"tag-green"},Tr={class:"px-3 py-2 whitespace-nowrap","data-col":"status"},jr={key:0,class:"tag-green"},Dr={key:1,class:"tag-red"},Hr={key:2,class:"tag-gray"},Ur={class:"px-3 py-2 whitespace-nowrap"},$r={class:"action-group"},_r={key:0,class:"action-btn rose",type:"button","data-action":"ban"},Fr={key:1,class:"action-btn red",type:"button","data-action":"delete"},qr={key:3,id:"adminVideo",class:"admin-panel hidden space-y-6"},Vr={class:"admin-card space-y-4"},Wr={id:"videoSourceForm",method:"post",action:"/dashboard/video/source/save",class:"space-y-3"},zr=["value"],Jr={key:4,id:"adminPan",class:"admin-panel hidden space-y-6"},Gr={key:5,id:"adminInterface",class:"admin-panel hidden space-y-6"},Qr={class:"admin-card space-y-4"},Kr={id:"catPawOpenSettingsForm",method:"post",action:"/dashboard/catpawopen/save",class:"space-y-4"},Xr=["value"],Zr={class:"admin-card space-y-4"},Yr={id:"goProxySettingsForm",method:"post",action:"/dashboard/goproxy/save",class:"space-y-4"},ti={class:"space-y-1"},ei={class:"enable-switch",title:"GoProxy 启用"},ai=["checked"],si={class:"space-y-1"},ni={class:"enable-switch",title:"GoProxy 自动优选"},ri=["checked"],ii={class:"admin-card space-y-4"},oi={id:"openListSettingsForm",method:"post",action:"/dashboard/openlist/save",class:"space-y-4"},di=["value"],ci=["value"],li=["value"],ui={key:6,id:"adminSearch",class:"admin-panel hidden space-y-6"},pi={key:7,id:"adminMagic",class:"admin-panel hidden space-y-6"},gi={key:8,id:"adminLive",class:"admin-panel hidden"},mi={__name:"DashboardPage",props:{bootstrap:{type:Object,required:!0}},setup(y){const ae=y;return jn(()=>{Dn(),Fn(ae.bootstrap)}),(Ve,p)=>(b(),v("div",qn,[d("aside",Vn,[p[2]||(p[2]=T('<div class="text-xl font-bold text-green-600 mb-6 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-dashboard"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M3 9h18"></path><path d="M9 21V9"></path></svg> 管理后台 </div>',1)),d("nav",Wn,[p[1]||(p[1]=T('<a href="/" class="nav-item group flex items-center rounded-lg px-3 py-2 pl-4 text-gray-700 hover:bg-gray-100/30 hover:text-green-600 dark:text-gray-100 dark:hover:bg-white/10 gap-3 justify-start transition-colors duration-200 min-h-[40px]"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-house h-5 w-5 text-gray-500 group-hover:text-green-600 dark:group-hover:text-green-400"><path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"></path><path d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg><span class="nav-label">回到首页</span></a>',1)),y.bootstrap.user.role==="admin"?(b(),v("div",zn,[...p[0]||(p[0]=[T('<a data-admin="site" class="admin-nav nav-item group flex items-center rounded-lg px-3 py-2 pl-4 text-gray-700 hover:bg-gray-100/30 hover:text-green-600 data-[active=true]:bg-green-500/20 data-[active=true]:text-green-700 dark:text-gray-100 dark:hover:bg-white/10 dark:data-[active=true]:text-green-300 gap-3 justify-start transition-colors duration-200 min-h-[40px]" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings h-5 w-5 text-gray-600 dark:text-gray-400 group-hover:text-green-600 dark:group-hover:text-green-400"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg><span class="nav-label">站点设置</span></a><a data-admin="user" class="admin-nav nav-item group flex items-center rounded-lg px-3 py-2 pl-4 text-gray-700 hover:bg-gray-100/30 hover:text-green-600 data-[active=true]:bg-green-500/20 data-[active=true]:text-green-700 dark:text-gray-100 dark:hover:bg-white/10 dark:data-[active=true]:text-green-300 gap-3 justify-start transition-colors duration-200 min-h-[40px]" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users h-5 w-5 text-gray-500 group-hover:text-green-600 dark:group-hover:text-green-400"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg><span class="nav-label">用户管理</span></a><a data-admin="pan" class="admin-nav nav-item group flex items-center rounded-lg px-3 py-2 pl-4 text-gray-700 hover:bg-gray-100/30 hover:text-green-600 data-[active=true]:bg-green-500/20 data-[active=true]:text-green-700 dark:text-gray-100 dark:hover:bg-white/10 dark:data-[active=true]:text-green-300 gap-3 justify-start transition-colors duration-200 min-h-[40px]" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cloud h-5 w-5 text-gray-500 group-hover:text-green-600 dark:group-hover:text-green-400"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h.79a4.5 4.5 0 1 1 1 9Z"></path></svg><span class="nav-label">网盘设置</span></a><a data-admin="interface" class="admin-nav nav-item group flex items-center rounded-lg px-3 py-2 pl-4 text-gray-700 hover:bg-gray-100/30 hover:text-green-600 data-[active=true]:bg-green-500/20 data-[active=true]:text-green-700 dark:text-gray-100 dark:hover:bg-white/10 dark:data-[active=true]:text-green-300 gap-3 justify-start transition-colors duration-200 min-h-[40px]" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link-2 h-5 w-5 text-gray-500 group-hover:text-green-600 dark:group-hover:text-green-400"><path d="M15 7h3a5 5 0 0 1 0 10h-3"></path><path d="M9 17H6a5 5 0 0 1 0-10h3"></path><line x1="8" x2="16" y1="12" y2="12"></line></svg><span class="nav-label">接口设置</span></a><a data-admin="video" class="admin-nav nav-item group flex items-center rounded-lg px-3 py-2 pl-4 text-gray-700 hover:bg-gray-100/30 hover:text-green-600 data-[active=true]:bg-green-500/20 data-[active=true]:text-green-700 dark:text-gray-100 dark:hover:bg-white/10 dark:data-[active=true]:text-green-300 gap-3 justify-start transition-colors duration-200 min-h-[40px]" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-film h-5 w-5 text-gray-500 group-hover:text-green-600 dark:group-hover:text-green-400"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M7 3v18"></path><path d="M3 7.5h4"></path><path d="M3 12h18"></path><path d="M3 16.5h4"></path><path d="M17 3v18"></path><path d="M17 7.5h4"></path><path d="M17 16.5h4"></path></svg><span class="nav-label">视频源管理</span></a><a data-admin="search" class="admin-nav nav-item group flex items-center rounded-lg px-3 py-2 pl-4 text-gray-700 hover:bg-gray-100/30 hover:text-green-600 data-[active=true]:bg-green-500/20 data-[active=true]:text-green-700 dark:text-gray-100 dark:hover:bg-white/10 dark:data-[active=true]:text-green-300 gap-3 justify-start transition-colors duration-200 min-h-[40px]" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search h-5 w-5 text-gray-500 group-hover:text-green-600 dark:group-hover:text-green-400"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg><span class="nav-label">站点搜索结果设置</span></a><a data-admin="magic" class="admin-nav nav-item group flex items-center rounded-lg px-3 py-2 pl-4 text-gray-700 hover:bg-gray-100/30 hover:text-green-600 data-[active=true]:bg-green-500/20 data-[active=true]:text-green-700 dark:text-gray-100 dark:hover:bg-white/10 dark:data-[active=true]:text-green-300 gap-3 justify-start transition-colors duration-200 min-h-[40px]" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wand-2 h-5 w-5 text-gray-500 group-hover:text-green-600 dark:group-hover:text-green-400"><path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2 18.99V22h3.01L21.64 5.36a1.21 1.21 0 0 0 0-1.72Z"></path><path d="m14 7 3 3"></path><path d="M5 6v4"></path><path d="M19 14v4"></path><path d="M10 2v2"></path><path d="M7 8H3"></path><path d="M21 16h-4"></path><path d="M11 3H9"></path></svg><span class="nav-label">魔法匹配设置</span></a><a data-admin="live" class="admin-nav nav-item group flex items-center rounded-lg px-3 py-2 pl-4 text-gray-700 hover:bg-gray-100/30 hover:text-green-600 data-[active=true]:bg-green-500/20 data-[active=true]:text-green-700 dark:text-gray-100 dark:hover:bg-white/10 dark:data-[active=true]:text-green-300 gap-3 justify-start transition-colors duration-200 min-h-[40px]" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-radio h-5 w-5 text-gray-500 group-hover:text-green-600 dark:group-hover:text-green-400"><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"></path><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"></path><circle cx="12" cy="12" r="2"></circle><path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"></path><path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"></path></svg><span class="nav-label">直播源管理</span></a>',8)])])):Q("",!0)])]),d("div",Jn,[d("div",Gn,[y.bootstrap.user.role!=="admin"?(b(),v("div",Qn,[...p[3]||(p[3]=[T('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shield-off text-gray-400"><path d="m19.69 14-4.8 4.8c-.55.55-1.29.86-2.06.87h-.66a3 3 0 0 1-2.21-.98l-5.32-5.69A2 2 0 0 1 4 11.38V5.53a2 2 0 0 1 1.23-1.84l5.52-2.21c.79-.32 1.68-.32 2.47 0l5.52 2.21A2 2 0 0 1 20 5.53V12"></path><path d="m2 2 20 20"></path></svg><div class="text-lg font-semibold text-gray-700">非管理员用户</div><div class="text-sm text-gray-500">当前账号没有访问管理后台的权限。</div>',3)])])):Q("",!0),y.bootstrap.user.role==="admin"?(b(),v("section",Kn,[d("form",Xn,[p[13]||(p[13]=d("h3",{class:"text-base font-semibold text-gray-800 dark:text-gray-100 mb-4 flex items-center gap-2"},[d("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-settings h-5 w-5 text-gray-600 dark:text-gray-300"},[d("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),d("circle",{cx:"12",cy:"12",r:"3"})]),Ps(" 站点设置 ")],-1)),d("div",null,[p[4]||(p[4]=d("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"},"站点名称",-1)),d("input",{name:"siteName",class:"tv-field",value:y.bootstrap.siteName,placeholder:"站点名称"},null,8,Zn)]),d("div",Yn,[d("div",null,[p[7]||(p[7]=d("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"},"豆瓣数据代理",-1)),d("select",tr,[d("option",{value:"direct",selected:y.bootstrap.settings.doubanDataProxy==="direct"},"直连（浏览器直接请求豆瓣）",8,er),d("option",{value:"cors",selected:y.bootstrap.settings.doubanDataProxy==="cors"},"Cors Proxy By Zwei",8,ar),d("option",{value:"cdn-tx",selected:y.bootstrap.settings.doubanDataProxy==="cdn-tx"},"豆瓣 CDN By CMLiussss（腾讯云）",8,sr),d("option",{value:"cdn-ali",selected:y.bootstrap.settings.doubanDataProxy==="cdn-ali"},"豆瓣 CDN By CMLiussss（阿里云）",8,nr),d("option",{value:"custom",selected:y.bootstrap.settings.doubanDataProxy==="custom"},"自定义代理",8,rr)]),p[8]||(p[8]=d("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"选择获取豆瓣数据的方式",-1)),d("div",{id:"doubanDataCustom",class:Ls(["mt-2",{hidden:y.bootstrap.settings.doubanDataProxy!=="custom"}])},[p[5]||(p[5]=d("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"},"豆瓣代理地址",-1)),d("input",{name:"doubanDataCustom",class:"tv-field",placeholder:"例如：https://proxy.example.com/fetch?url=",value:y.bootstrap.settings.doubanDataCustom},null,8,ir),p[6]||(p[6]=d("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"自定义代理服务器地址",-1))],2)]),d("div",null,[p[11]||(p[11]=d("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"},"豆瓣图片代理",-1)),d("select",or,[d("option",{value:"direct-browser",selected:y.bootstrap.settings.doubanImgProxy==="direct-browser"},"直连（浏览器直接请求豆瓣）",8,dr),d("option",{value:"server-proxy",selected:y.bootstrap.settings.doubanImgProxy==="server-proxy"},"服务器代理（由服务器代理请求豆瓣）",8,cr),d("option",{value:"douban-cdn-ali",selected:y.bootstrap.settings.doubanImgProxy==="douban-cdn-ali"},"豆瓣官方精品 CDN（阿里云）",8,lr),d("option",{value:"cdn-tx",selected:y.bootstrap.settings.doubanImgProxy==="cdn-tx"},"豆瓣 CDN By CMLiussss（腾讯云）",8,ur),d("option",{value:"cdn-ali",selected:y.bootstrap.settings.doubanImgProxy==="cdn-ali"},"豆瓣 CDN By CMLiussss（阿里云）",8,pr),d("option",{value:"custom",selected:y.bootstrap.settings.doubanImgProxy==="custom"},"自定义代理",8,gr)]),p[12]||(p[12]=d("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"选择获取豆瓣图片的方式",-1)),d("div",{id:"doubanImgCustom",class:Ls(["mt-2",{hidden:y.bootstrap.settings.doubanImgProxy!=="custom"}])},[p[9]||(p[9]=d("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"},"豆瓣图片代理地址",-1)),d("input",{name:"doubanImgCustom",class:"tv-field",placeholder:"例如：https://proxy.example.com/fetch?url=",value:y.bootstrap.settings.doubanImgCustom},null,8,mr),p[10]||(p[10]=d("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"自定义图片代理服务器地址",-1))],2)])]),p[14]||(p[14]=d("div",{class:"pt-2 flex justify-start"},[d("div",{class:"flex flex-col gap-2"},[d("button",{type:"submit",class:"btn-green"},"保存"),d("div",{id:"saveStatus",class:"text-sm hidden"})])],-1))])])):Q("",!0),y.bootstrap.user.role==="admin"?(b(),v("section",yr,[p[20]||(p[20]=T('<div class="flex items-center gap-2 text-gray-800 dark:text-gray-100 text-base font-semibold"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users h-5 w-5 text-gray-600 dark:text-gray-300"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg> 用户配置 </div>',1)),d("div",hr,[d("div",{id:"userCount",class:"stat-main",textContent:qe(y.bootstrap.userCount)},null,8,fr),p[15]||(p[15]=d("div",{class:"stat-label"},"总用户数",-1))]),d("div",xr,[p[19]||(p[19]=d("div",{class:"flex items-center justify-between mb-3"},[d("div",{class:"text-sm font-semibold text-gray-700 dark:text-gray-200 flex items-center gap-2"},[Ps(" 用户列表 "),d("button",{id:"openAddUser",class:"btn-green"},"添加用户")])],-1)),d("div",vr,[d("div",br,[p[18]||(p[18]=d("form",{id:"addUserForm",class:"space-y-3 mb-4 w-full",method:"post",action:"/dashboard/user/add",hidden:""},[d("div",{class:"grid items-center",style:{"grid-template-columns":"max-content 1fr",gap:"14px 18px"}},[d("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-200 whitespace-nowrap"},"用户名："),d("input",{id:"addUserName",name:"username",class:"tv-field",placeholder:"用户名",autocomplete:"off"}),d("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-200 whitespace-nowrap"},"密码："),d("input",{id:"addUserPassword",name:"password",type:"password",class:"tv-field tv-field-success",placeholder:"密码",autocomplete:"new-password"}),d("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-200 whitespace-nowrap"},"角色："),d("select",{id:"addUserRole",name:"role",class:"tv-field"},[d("option",{value:"user",selected:""},"用户"),d("option",{value:"shared"},"共享")]),d("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-200 whitespace-nowrap"},"Cat接口："),d("input",{id:"addUserCatApiBase",name:"catApiBase",class:"tv-field",placeholder:"CatPawOpen 接口地址（可留空）",autocomplete:"off"}),d("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-200 whitespace-nowrap"},"Cat代理："),d("input",{id:"addUserCatProxy",name:"catProxy",class:"tv-field",placeholder:"CatPawOpen 全局代理地址（可留空）",autocomplete:"off"})]),d("div",{class:"flex justify-start"},[d("button",{id:"confirmAddUser",class:"btn-add",type:"submit"},"添加")]),d("div",{id:"addUserStatus",class:"text-sm",hidden:""})],-1)),d("table",wr,[p[17]||(p[17]=d("thead",{class:"table-head"},[d("tr",null,[d("th",{class:"px-3 py-2 whitespace-nowrap"},"用户名"),d("th",{class:"px-3 py-2 whitespace-nowrap"},"角色"),d("th",{class:"px-3 py-2 whitespace-nowrap"},"Cat接口"),d("th",{class:"px-3 py-2 whitespace-nowrap"},"Cat代理"),d("th",{class:"px-3 py-2 whitespace-nowrap"},"状态"),d("th",{class:"px-3 py-2 whitespace-nowrap"},"操作")])],-1)),d("tbody",kr,[(b(!0),v(Hn,null,Un(y.bootstrap.users||[],P=>(b(),v("tr",{key:P.username,"data-username":P.username,"data-role":P.role,"data-status":P.status,"data-cat-api-base":P.cat_api_base||"","data-cat-proxy":P.cat_proxy||""},[d("td",Cr,qe(P.username),1),d("td",Er,[P.role==="admin"?(b(),v("span",Ar,"管理员")):P.role==="shared"?(b(),v("span",Br,"共享")):(b(),v("span",Pr,"用户"))]),d("td",Lr,[(P.cat_api_base||"").trim()?(b(),v("span",Rr,"已设置")):(b(),v("span",Ir,"未设置"))]),d("td",Or,[(P.cat_proxy||"").trim()?(b(),v("span",Nr,"已设置")):(b(),v("span",Mr,"未设置"))]),d("td",Tr,[P.status==="active"?(b(),v("span",jr,"正常")):P.status==="banned"?(b(),v("span",Dr,"封禁")):(b(),v("span",Hr,qe(P.status),1))]),d("td",Ur,[d("div",$r,[p[16]||(p[16]=d("button",{class:"action-btn blue",type:"button","data-action":"edit"},"修改",-1)),P.role!=="admin"?(b(),v("button",_r,qe(P.status==="active"?"封禁":"解封"),1)):Q("",!0),P.role!=="admin"?(b(),v("button",Fr,"删除")):Q("",!0)])])],8,Sr))),128))])])])])])])):Q("",!0),y.bootstrap.user.role==="admin"?(b(),v("section",qr,[p[23]||(p[23]=T('<div class="flex items-center gap-2 text-gray-800 dark:text-gray-100 text-base font-semibold"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-film h-5 w-5 text-gray-600 dark:text-gray-300"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M7 3v18"></path><path d="M3 7.5h4"></path><path d="M3 12h18"></path><path d="M3 16.5h4"></path><path d="M17 3v18"></path><path d="M17 7.5h4"></path><path d="M17 16.5h4"></path></svg> 视频源管理 </div>',1)),d("div",Vr,[d("form",Wr,[d("div",null,[p[21]||(p[21]=d("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"},"视频源地址",-1)),d("input",{id:"videoSourceUrl",name:"videoSourceUrl",type:"url",class:"tv-field",placeholder:"http://example.com/config.js",value:y.bootstrap.settings.videoSourceUrl},null,8,zr)]),p[22]||(p[22]=T('<div class="flex justify-start"><div class="flex flex-col gap-2"><div class="flex items-center gap-2"><button type="submit" class="btn-green">保存</button><button id="videoSourceImportFromCatPawOpen" type="button" class="px-3 py-2 rounded-lg border border-gray-200 dark:border-white/10 bg-white/60 dark:bg-white/5 text-sm text-gray-700 dark:text-gray-100 hover:bg-gray-100/50 dark:hover:bg-white/10 transition-colors duration-150">从 CatPawOpen 导入站源</button></div><div id="videoSourceSaveStatus" class="text-sm hidden"></div></div></div>',1))])]),p[24]||(p[24]=T('<div class="space-y-3"><div class="tv-panel overflow-x-auto"><div class="tv-row mb-2"><span id="panHeaderName" class="text-sm font-medium text-gray-600 dark:text-gray-300 truncate">网盘名称</span><span id="panHeaderEnable" class="text-sm font-medium text-gray-600 dark:text-gray-300">是否启用</span><span id="panHeaderSort" class="text-sm font-medium text-gray-600 dark:text-gray-300">排序</span><div id="panListSaveStatus" class="text-xs hidden whitespace-nowrap ml-2 text-gray-500 dark:text-gray-400"></div></div><ul id="panList" class="space-y-2 text-sm text-gray-700 dark:text-gray-200"><li class="text-gray-500 dark:text-gray-400">无数据</li></ul></div></div><div class="space-y-3"><div class="max-h-[60vh] overflow-y-auto tv-panel"><div class="video-source-header tv-row sticky top-0 z-[2] mb-2"><input id="videoSourceHeaderCheckbox" type="checkbox" class="h-4 w-4 rounded border-gray-300 dark:border-white/20 text-green-600 focus:ring-green-500"><span id="videoSourceHeaderName" class="text-sm font-medium text-gray-600 dark:text-gray-300 truncate">站源名称</span><span id="videoSourceHeaderApi" class="text-sm font-medium text-gray-600 dark:text-gray-300 truncate">路由/API</span><span id="videoSourceHeaderAvailability" class="text-sm font-medium text-gray-600 dark:text-gray-300">站点可用性</span><span id="videoSourceHeaderStatus" class="text-sm font-medium text-gray-600 dark:text-gray-300">是否启用</span><span id="videoSourceHeaderHome" class="text-sm font-medium text-gray-600 dark:text-gray-300">首页显示</span><span id="videoSourceHeaderSort" class="text-sm font-medium text-gray-600 dark:text-gray-300">排序</span><div id="videoSourceBulkActions" class="hidden flex items-center gap-2 ml-2"><button id="videoSourceBulkCheckDisable" type="button" class="px-2 py-1 rounded-full border border-gray-400 text-xs font-medium text-gray-700 hover:bg-gray-500/10 dark:border-white/20 dark:text-gray-100 dark:hover:bg-white/10 transition-colors duration-150"> 检测并禁用失效源 </button><button id="videoSourceBulkEnable" type="button" class="px-2 py-1 rounded-full border border-green-500 text-xs font-medium text-green-600 hover:bg-green-500/10 transition-colors duration-150"> 批量启用 </button><button id="videoSourceBulkDisable" type="button" class="px-2 py-1 rounded-full border border-red-500 text-xs font-medium text-red-600 hover:bg-red-500/10 transition-colors duration-150"> 批量禁用 </button></div><div id="videoSourceListSaveStatus" class="text-xs hidden whitespace-nowrap ml-2 text-gray-500 dark:text-gray-400"></div></div><ul id="videoSourceList" class="space-y-2 text-sm text-gray-700 dark:text-gray-200"><li class="text-gray-500 dark:text-gray-400">暂无站源，解析完成后会在这里展示。</li></ul></div></div>',2))])):Q("",!0),y.bootstrap.user.role==="admin"?(b(),v("section",Jr,[...p[25]||(p[25]=[T('<div class="flex items-center gap-2 text-gray-800 dark:text-gray-100 text-base font-semibold"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cloud h-5 w-5 text-gray-600 dark:text-gray-300"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h.79a4.5 4.5 0 1 1 1 9Z"></path></svg> 网盘设置 </div><div class="admin-card space-y-4"><div class="flex items-center gap-2"><button id="panSettingsScrollLeft" type="button" class="hidden px-2 py-2 rounded-lg border border-gray-200 dark:border-white/10 bg-white/60 dark:bg-white/5 text-gray-700 dark:text-gray-100 hover:bg-gray-100/50 dark:hover:bg-white/10 transition-colors duration-150" title="向左滚动">&lt;</button><div id="panSettingsTabs" class="flex items-center gap-2 overflow-x-auto pb-1 min-w-0 flex-1"></div><button id="panSettingsScrollRight" type="button" class="hidden px-2 py-2 rounded-lg border border-gray-200 dark:border-white/10 bg-white/60 dark:bg-white/5 text-gray-700 dark:text-gray-100 hover:bg-gray-100/50 dark:hover:bg-white/10 transition-colors duration-150" title="向右滚动">&gt;</button><div class="relative"><button id="panSettingsMoreBtn" type="button" class="hidden px-2 py-2 rounded-lg border border-gray-200 dark:border-white/10 bg-white/60 dark:bg-white/5 text-gray-700 dark:text-gray-100 hover:bg-gray-100/50 dark:hover:bg-white/10 transition-colors duration-150" title="更多">…</button><div id="panSettingsMoreMenu" class="hidden absolute right-0 mt-2 w-44 rounded-lg border border-gray-200 dark:border-white/10 bg-white dark:bg-[#0f172a] shadow-lg overflow-hidden z-10"></div></div></div><div id="panSettingsContent" class="min-h-[320px]"></div><div id="panSettingsStatus" class="text-sm hidden"></div></div>',2)])])):Q("",!0),y.bootstrap.user.role==="admin"?(b(),v("section",Gr,[p[43]||(p[43]=T('<div class="flex items-center gap-2 text-gray-800 dark:text-gray-100 text-base font-semibold"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link-2 h-5 w-5 text-gray-600 dark:text-gray-300"><path d="M15 7h3a5 5 0 0 1 0 10h-3"></path><path d="M9 17H6a5 5 0 0 1 0-10h3"></path><line x1="8" x2="16" y1="12" y2="12"></line></svg> 接口设置 </div>',1)),d("div",Qr,[d("form",Kr,[p[27]||(p[27]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"text-sm font-semibold text-gray-700 dark:text-gray-200"},"CatPawOpen 设置"),d("div",{id:"catPawOpenSaveStatus",class:"text-xs hidden whitespace-nowrap text-gray-500 dark:text-gray-400"})],-1)),d("div",null,[p[26]||(p[26]=d("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"},"CatPawOpen 接口地址",-1)),d("input",{name:"catPawOpenApiBase",class:"tv-field",placeholder:"http://127.0.0.1:3006/",value:y.bootstrap.settings.catPawOpenApiBase},null,8,Xr)]),p[28]||(p[28]=T('<div id="catPawOpenRemoteError" class="hidden rounded-lg border border-red-200 dark:border-red-900/40 bg-red-50 dark:bg-red-900/10 px-3 py-2 text-xs text-red-700 dark:text-red-300"></div><div id="catPawOpenRemoteSettings" class="hidden space-y-4"><div><label class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1">CatPawOpen 全局代理</label><input name="catPawOpenProxy" class="tv-field" placeholder="http://127.0.0.1:7890"><p class="text-xs text-gray-500 dark:text-gray-400 mt-1">保存后将同步到 CatPawOpen 并立即生效（留空关闭）。</p></div><div class="space-y-1 pt-1"><div class="text-sm font-medium text-gray-700 dark:text-gray-200">直链模式</div><div><label class="enable-switch" title="直链模式"><input id="catPawOpenDirectLinkEnabled" name="catPawOpenDirectLinkEnabled" type="checkbox"><span class="enable-slider"></span></label></div><div class="text-xs text-gray-500 dark:text-gray-400">开启后 CatPawOpen 始终返回直链。</div></div></div><div class="pt-1 flex justify-start"><button type="submit" class="btn-green">保存</button></div>',3))])]),d("div",Zr,[p[36]||(p[36]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"text-sm font-semibold text-gray-700 dark:text-gray-200"},"GoProxy 设置"),d("div",{id:"goProxySaveStatus",class:"text-xs hidden whitespace-nowrap text-gray-500 dark:text-gray-400"})],-1)),d("form",Yr,[d("div",ti,[p[30]||(p[30]=d("div",{class:"text-sm font-medium text-gray-700 dark:text-gray-200"},"GoProxy 启用",-1)),d("div",null,[d("label",ei,[d("input",{id:"goProxyEnabled",name:"goProxyEnabled",type:"checkbox",checked:y.bootstrap.settings.goProxyEnabled},null,8,ai),p[29]||(p[29]=d("span",{class:"enable-slider"},null,-1))])]),p[31]||(p[31]=d("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"开启后由客户端将直链注册到 GoProxy。",-1))]),d("div",si,[p[33]||(p[33]=d("div",{class:"text-sm font-medium text-gray-700 dark:text-gray-200"},"GoProxy 自动优选",-1)),d("div",null,[d("label",ni,[d("input",{id:"goProxyAutoSelect",name:"goProxyAutoSelect",type:"checkbox",checked:y.bootstrap.settings.goProxyAutoSelect},null,8,ri),p[32]||(p[32]=d("span",{class:"enable-slider"},null,-1))])]),p[34]||(p[34]=d("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"开启后会测速并自动选择最快服务器。",-1))]),p[35]||(p[35]=T('<input type="hidden" id="goProxyServersJson" name="goProxyServersJson" value=""><div class="space-y-2"><div class="text-sm font-medium text-gray-700 dark:text-gray-200">GoProxy 服务器</div><div class="flex items-center gap-2"><input id="goProxyServerInput" class="tv-field flex-1 min-w-0" placeholder="https://catproxy.example.com" autocomplete="off"><button id="goProxyServerAdd" type="button" class="btn-green">添加</button></div><ul id="goProxyServerList" class="space-y-2 text-sm text-gray-700 dark:text-gray-200"><li class="text-gray-500 dark:text-gray-400">无数据</li></ul></div><div class="pt-1 flex justify-start"><button type="submit" class="btn-green">保存</button></div>',3))])]),d("div",ii,[p[42]||(p[42]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"text-sm font-semibold text-gray-700 dark:text-gray-200"},"OpenList 设置"),d("div",{id:"openListSaveStatus",class:"text-xs hidden whitespace-nowrap text-gray-500 dark:text-gray-400"})],-1)),d("form",oi,[d("div",null,[p[37]||(p[37]=d("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"},"OpenList 服务器地址",-1)),d("input",{name:"openListApiBase",class:"tv-field",placeholder:"http://127.0.0.1:5244/",value:y.bootstrap.settings.openListApiBase},null,8,di)]),d("div",null,[p[38]||(p[38]=d("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"},"OpenList 令牌",-1)),d("input",{name:"openListToken",class:"tv-field",type:"password",autocomplete:"off",placeholder:"token",value:y.bootstrap.settings.openListToken},null,8,ci)]),p[40]||(p[40]=T('<div class="space-y-1 pt-1"><div class="text-sm font-medium text-gray-700 dark:text-gray-200">夸克 TV 模式</div><div><label class="enable-switch" title="夸克 TV 模式"><input id="openListQuarkTvMode" name="openListQuarkTvMode" type="checkbox"><span class="enable-slider"></span></label></div></div>',1)),d("div",null,[p[39]||(p[39]=d("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"},"夸克 TV 挂载目录",-1)),d("input",{name:"openListQuarkTvMount",class:"tv-field",placeholder:"/quark/",value:y.bootstrap.settings.openListQuarkTvMount},null,8,li)]),p[41]||(p[41]=d("div",{class:"pt-1 flex justify-start"},[d("button",{type:"submit",class:"btn-green"},"保存")],-1))])])])):Q("",!0),y.bootstrap.user.role==="admin"?(b(),v("section",ui,[...p[44]||(p[44]=[T('<div class="flex items-center gap-2 text-gray-800 dark:text-gray-100 text-base font-semibold"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search h-5 w-5 text-gray-600 dark:text-gray-300"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg> 站点搜索结果设置 </div><div class="tv-panel overflow-x-auto"><div class="tv-row mb-2"><span id="searchHeaderName" class="text-sm font-medium text-gray-600 dark:text-gray-300 truncate">站点名称</span><span id="searchHeaderCover" class="text-sm font-medium text-gray-600 dark:text-gray-300">聚合图片显示</span><span id="searchHeaderSort" class="text-sm font-medium text-gray-600 dark:text-gray-300">排序</span><div id="searchSettingsSaveStatus" class="text-xs hidden whitespace-nowrap ml-2 text-gray-500 dark:text-gray-400"></div></div><ul id="searchSettingsList" class="space-y-2 text-sm text-gray-700 dark:text-gray-200"><li class="text-gray-500 dark:text-gray-400">无数据</li></ul></div>',2)])])):Q("",!0),y.bootstrap.user.role==="admin"?(b(),v("section",pi,[...p[45]||(p[45]=[T('<div class="flex items-center gap-2 text-gray-800 dark:text-gray-100 text-base font-semibold"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wand-2 h-5 w-5 text-gray-600 dark:text-gray-300"><path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2 18.99V22h3.01L21.64 5.36a1.21 1.21 0 0 0 0-1.72Z"></path><path d="m14 7 3 3"></path><path d="M5 6v4"></path><path d="M19 14v4"></path><path d="M10 2v2"></path><path d="M7 8H3"></path><path d="M21 16h-4"></path><path d="M11 3H9"></path></svg> 魔法匹配设置 </div><div class="admin-card space-y-3"><div class="text-sm font-medium text-gray-700 dark:text-gray-200">列表清洗正则</div><div class="flex items-center gap-2"><div class="min-w-0" style="flex:0 0 50%;max-width:50%;"><input id="magicEpisodeCleanRegexRuleInput" class="tv-field min-w-0" placeholder="\\\\[.*?\\\\]|\\\\(.*?\\\\)|更新至\\\\d+集"></div><button id="magicEpisodeCleanRegexRuleAdd" type="button" class="btn-green">添加</button></div><div id="magicEpisodeCleanRegexRuleStatus" class="text-xs hidden"></div><ul id="magicEpisodeCleanRegexRuleList" class="space-y-2 text-sm text-gray-700 dark:text-gray-200"><li class="text-gray-500 dark:text-gray-400">无数据</li></ul><div class="pt-3 border-t border-gray-200 dark:border-white/10"><div class="text-sm font-medium text-gray-700 dark:text-gray-200">选集匹配规则</div></div><div class="flex flex-col gap-2"><div class="flex items-center gap-2"><div class="flex items-center gap-2 min-w-0" style="flex:0 0 50%;max-width:50%;"><input id="magicEpisodeRulePatternInput" class="tv-field min-w-0" style="flex:5 1 0;" placeholder=".*?([Ss]\\\\d{1,2})?(?:[第EePpXx\\\\.\\\\-_\\\\( ]{1,2}|^)(\\\\d{1,3})(?!\\\\d).*?\\\\.(mp4|mkv)"><input id="magicEpisodeRuleReplaceInput" class="tv-field min-w-0" style="flex:1 1 0;" placeholder="$1E$2.$3"></div><button id="magicEpisodeRuleAdd" type="button" class="btn-green">添加</button></div></div><div id="magicEpisodeRuleStatus" class="text-xs hidden"></div><ul id="magicEpisodeRuleList" class="space-y-2 text-sm text-gray-700 dark:text-gray-200"><li class="text-gray-500 dark:text-gray-400">无数据</li></ul><div class="pt-2 border-t border-gray-200 dark:border-white/10 space-y-2"><div class="text-sm font-medium text-gray-700 dark:text-gray-200">规则测试</div><div class="flex items-center gap-2"><div class="min-w-0" style="flex:0 0 50%;max-width:50%;"><input id="magicEpisodeRuleTestInput" class="tv-field min-w-0" placeholder="仙逆.S01E006.mkv"></div><button id="magicEpisodeRuleTestBtn" type="button" class="btn-green">测试</button></div><div class="min-w-0" style="width:50%;max-width:50%;"><div id="magicEpisodeRuleTestOutput" class="text-xs hidden text-gray-600 dark:text-gray-300 truncate" style="width:100%;"></div></div></div></div><div class="admin-card space-y-3"><div class="text-sm font-medium text-gray-700 dark:text-gray-200">聚合搜索清洗关键词</div><div class="flex items-center gap-2"><div class="min-w-0" style="flex:0 0 50%;max-width:50%;"><input id="magicAggregateRuleInput" class="tv-field min-w-0" placeholder="年番、完结、更新至"></div><button id="magicAggregateRuleAdd" type="button" class="btn-green">添加</button></div><div id="magicAggregateRuleStatus" class="text-xs hidden"></div><ul id="magicAggregateRuleList" class="space-y-2 text-sm text-gray-700 dark:text-gray-200"><li class="text-gray-500 dark:text-gray-400">无数据</li></ul><div class="pt-3 border-t border-gray-200 dark:border-white/10 space-y-3"><div class="text-sm font-medium text-gray-700 dark:text-gray-200">聚合搜索清洗正则</div><div class="flex items-center gap-2"><div class="min-w-0" style="flex:0 0 50%;max-width:50%;"><input id="magicAggregateRegexRuleInput" class="tv-field min-w-0" placeholder="\\\\(\\\\d{4}\\\\)|\\\\[.*?\\\\]|更新至\\\\d+集"></div><button id="magicAggregateRegexRuleAdd" type="button" class="btn-green">添加</button></div><div id="magicAggregateRegexRuleStatus" class="text-xs hidden"></div><ul id="magicAggregateRegexRuleList" class="space-y-2 text-sm text-gray-700 dark:text-gray-200"><li class="text-gray-500 dark:text-gray-400">无数据</li></ul><div class="pt-2 border-t border-gray-200 dark:border-white/10 space-y-2"><div class="text-sm font-medium text-gray-700 dark:text-gray-200">规则测试</div><div class="flex items-center gap-2"><div class="min-w-0" style="flex:0 0 50%;max-width:50%;"><input id="magicAggregateRuleTestInput" class="tv-field min-w-0" placeholder="仙逆 年番 更新至123集 (2023)"></div><button id="magicAggregateRuleTestBtn" type="button" class="btn-green">测试</button></div><div class="min-w-0" style="width:50%;max-width:50%;"><div id="magicAggregateRuleTestOutput" class="text-xs hidden text-gray-600 dark:text-gray-300 truncate" style="width:100%;"></div></div></div></div></div>',3)])])):Q("",!0),y.bootstrap.user.role==="admin"?(b(),v("section",gi,[...p[46]||(p[46]=[d("div",{class:"text-sm text-gray-500 dark:text-gray-400"},"直播源管理内容占位",-1)])])):Q("",!0)])])]))}};(async()=>{const y=await $n("dashboard");if(!y||!y.siteName||!y.authenticated){window.location.href="/";return}document.title=`管理后台 - ${y.siteName}`,_n(mi,{bootstrap:y}).mount("#app")})();
